<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.6.2">Jekyll</generator><link href="http://jevic.cn/feed.xml" rel="self" type="application/atom+xml" /><link href="http://jevic.cn/" rel="alternate" type="text/html" /><updated>2018-01-10T15:47:42+08:00</updated><id>http://jevic.cn/</id><title type="html">Jevic</title><subtitle>前路漫漫,忆往昔......</subtitle><author><name>Jevic</name></author><entry><title type="html">Kafka 配置文件详解</title><link href="http://jevic.cn/2017/12/29/kafka-server-config/" rel="alternate" type="text/html" title="Kafka 配置文件详解" /><published>2017-12-29T17:24:37+08:00</published><updated>2017-12-29T17:24:37+08:00</updated><id>http://jevic.cn/2017/12/29/kafka-server-config</id><content type="html" xml:base="http://jevic.cn/2017/12/29/kafka-server-config/">&lt;h2 id=&quot;kafka-参数说明&quot;&gt;kafka 参数说明&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;p&gt;server.properties配置如下：&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;broker.id&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
num.network.threads&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2
num.io.threads&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;8
socket.send.buffer.bytes&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1048576
socket.receive.buffer.bytes&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1048576
socket.request.max.bytes&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;104857600
log.dirs&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/tmp/kafka-logs
num.partitions&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2
log.retention.hours&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;168
 
log.segment.bytes&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;536870912
log.retention.check.interval.ms&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;60000
log.cleaner.enable&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;false
 
&lt;/span&gt;zookeeper.connect&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;localhost:2181
zookeeper.connection.timeout.ms&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1000000
 
指定每一个server.properties对应项的含义：
参数
说明&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;解释&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
broker.id &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
每一个broker在集群中的唯一表示，要求是正数。当该服务器的IP地址发生改变时，broker.id没有变化，则不会影响consumers的消息情况
log.dirs&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/data/kafka-logs
kafka数据的存放地址，多个地址的话用逗号分割 /data/kafka-logs-1，/data/kafka-logs-2
port &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;9092
broker server服务端口
message.max.bytes &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;6525000
表示消息体的最大大小，单位是字节
num.network.threads &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4
broker处理消息的最大线程数，一般情况下不需要去修改
num.io.threads &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;8
broker处理磁盘IO的线程数，数值应该大于你的硬盘数
background.threads &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4
一些后台任务处理的线程数，例如过期消息文件的删除等，一般情况下不需要去做修改
queued.max.requests &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;500
等待IO线程处理的请求队列最大数，若是等待IO的请求超过这个数值，那么会停止接受外部消息，应该是一种自我保护机制。
host.name
broker的主机地址，若是设置了，那么会绑定到这个地址上，若是没有，会绑定到所有的接口上，并将其中之一发送到ZK，一般不设置
socket.send.buffer.bytes&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;100&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1024
socket的发送缓冲区，socket的调优参数SO_SNDBUFF
socket.receive.buffer.bytes &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;100&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1024
socket的接受缓冲区，socket的调优参数SO_RCVBUFF
socket.request.max.bytes &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;100&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1024&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1024
socket请求的最大数值，防止serverOOM，message.max.bytes必然要小于socket.request.max.bytes，会被topic创建时的指定参数覆盖
log.segment.bytes &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1024&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1024&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1024
topic的分区是以一堆segment文件存储的，这个控制每个segment的大小，会被topic创建时的指定参数覆盖
log.roll.hours &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;24&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;7
这个参数会在日志segment没有达到log.segment.bytes设置的大小，也会强制新建一个segment会被 topic创建时的指定参数覆盖
log.cleanup.policy &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; delete
日志清理策略选择有：delete和compact主要针对过期数据的处理，或是日志文件达到限制的额度，会被 topic创建时的指定参数覆盖
log.retention.minutes&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3days
数据存储的最大时间超过这个时间会根据log.cleanup.policy设置的策略处理数据，也就是消费端能够多久去消费数据
log.retention.bytes和log.retention.minutes任意一个达到要求，都会执行删除，会被topic创建时的指定参数覆盖
log.retention.bytes&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-1&lt;/span&gt;
topic每个分区的最大文件大小，一个topic的大小限制 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 分区数&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;log.retention.bytes。-1没有大小限log.retention.bytes和log.retention.minutes任意一个达到要求，都会执行删除，会被topic创建时的指定参数覆盖
log.retention.check.interval.ms&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5minutes
文件大小检查的周期时间，是否处罚 log.cleanup.policy中设置的策略
log.cleaner.enable&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;false
&lt;/span&gt;是否开启日志压缩
log.cleaner.threads &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2
日志压缩运行的线程数
log.cleaner.io.max.bytes.per.second&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;None
日志压缩时候处理的最大大小
log.cleaner.dedupe.buffer.size&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;500&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1024&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1024
日志压缩去重时候的缓存空间，在空间允许的情况下，越大越好
log.cleaner.io.buffer.size&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;512&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1024
日志清理时候用到的IO块大小一般不需要修改
log.cleaner.io.buffer.load.factor &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.9
日志清理中hash表的扩大因子一般不需要修改
log.cleaner.backoff.ms &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;15000
检查是否处罚日志清理的间隔
log.cleaner.min.cleanable.ratio&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.5
日志清理的频率控制，越大意味着更高效的清理，同时会存在一些空间上的浪费，会被topic创建时的指定参数覆盖
log.cleaner.delete.retention.ms &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1day
对于压缩的日志保留的最长时间，也是客户端消费消息的最长时间，同log.retention.minutes的区别在于一个控制未压缩数据，一个控制压缩后的数据。会被topic创建时的指定参数覆盖
log.index.size.max.bytes &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1024&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1024
对于segment日志的索引文件大小限制，会被topic创建时的指定参数覆盖
log.index.interval.bytes &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4096
当执行一个fetch操作后，需要一定的空间来扫描最近的offset大小，设置越大，代表扫描速度越快，但是也更好内存，一般情况下不需要搭理这个参数
log.flush.interval.messages&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;None
log文件”sync”到磁盘之前累积的消息条数,因为磁盘IO操作是一个慢操作,但又是一个”数据可靠性&lt;span class=&quot;s2&quot;&gt;&quot;的必要手段,所以此参数的设置,需要在&quot;&lt;/span&gt;数据可靠性&lt;span class=&quot;s2&quot;&gt;&quot;与&quot;&lt;/span&gt;性能&lt;span class=&quot;s2&quot;&gt;&quot;之间做必要的权衡.如果此值过大,将会导致每次&quot;&lt;/span&gt;fsync&lt;span class=&quot;s2&quot;&gt;&quot;的时间较长(IO阻塞),如果此值过小,将会导致&quot;&lt;/span&gt;fsync&lt;span class=&quot;s2&quot;&gt;&quot;的次数较多,这也意味着整体的client请求有一定的延迟.物理server故障,将会导致没有fsync的消息丢失.
log.flush.scheduler.interval.ms =3000
检查是否需要固化到硬盘的时间间隔
log.flush.interval.ms = None
仅仅通过interval来控制消息的磁盘写入时机,是不足的.此参数用于控制&quot;&lt;/span&gt;fsync&lt;span class=&quot;s2&quot;&gt;&quot;的时间间隔,如果消息量始终没有达到阀值,但是离上一次磁盘同步的时间间隔达到阀值,也将触发.
log.delete.delay.ms =60000
文件在索引中清除后保留的时间一般不需要去修改
log.flush.offset.checkpoint.interval.ms =60000
控制上次固化硬盘的时间点，以便于数据恢复一般不需要去修改
auto.create.topics.enable =true
是否允许自动创建topic，若是false，就需要通过命令创建topic
default.replication.factor =1
是否允许自动创建topic，若是false，就需要通过命令创建topic
num.partitions =1
每个topic的分区个数，若是在topic创建时候没有指定的话会被topic创建时的指定参数覆盖
 
 
以下是kafka中Leader,replicas配置参数
 
controller.socket.timeout.ms =30000
partition leader与replicas之间通讯时,socket的超时时间
controller.message.queue.size=10
partition leader与replicas数据同步时,消息的队列尺寸
replica.lag.time.max.ms =10000
replicas响应partition leader的最长等待时间，若是超过这个时间，就将replicas列入ISR(in-sync replicas)，并认为它是死的，不会再加入管理中
replica.lag.max.messages =4000
如果follower落后与leader太多,将会认为此follower[或者说partition relicas]已经失效
##通常,在follower与leader通讯时,因为网络延迟或者链接断开,总会导致replicas中消息同步滞后
##如果消息之后太多,leader将认为此follower网络延迟较大或者消息吞吐能力有限,将会把此replicas迁移
##到其他follower中.
##在broker数量较少,或者网络不足的环境中,建议提高此值.
replica.socket.timeout.ms=30*1000
follower与leader之间的socket超时时间
replica.socket.receive.buffer.bytes=64*1024
leader复制时候的socket缓存大小
replica.fetch.max.bytes =1024*1024
replicas每次获取数据的最大大小
replica.fetch.wait.max.ms =500
replicas同leader之间通信的最大等待时间，失败了会重试
replica.fetch.min.bytes =1
fetch的最小数据尺寸,如果leader中尚未同步的数据不足此值,将会阻塞,直到满足条件
num.replica.fetchers=1
leader进行复制的线程数，增大这个数值会增加follower的IO
replica.high.watermark.checkpoint.interval.ms =5000
每个replica检查是否将最高水位进行固化的频率
controlled.shutdown.enable =false
是否允许控制器关闭broker ,若是设置为true,会关闭所有在这个broker上的leader，并转移到其他broker
controlled.shutdown.max.retries =3
控制器关闭的尝试次数
controlled.shutdown.retry.backoff.ms =5000
每次关闭尝试的时间间隔
leader.imbalance.per.broker.percentage =10
leader的不平衡比例，若是超过这个数值，会对分区进行重新的平衡
leader.imbalance.check.interval.seconds =300
检查leader是否不平衡的时间间隔
offset.metadata.max.bytes
客户端保留offset信息的最大空间大小
kafka中zookeeper参数配置
 
zookeeper.connect = localhost:2181
zookeeper集群的地址，可以是多个，多个之间用逗号分割 hostname1:port1,hostname2:port2,hostname3:port3
zookeeper.session.timeout.ms=6000
ZooKeeper的最大超时时间，就是心跳的间隔，若是没有反映，那么认为已经死了，不易过大
zookeeper.connection.timeout.ms =6000
ZooKeeper的连接超时时间
zookeeper.sync.time.ms =2000
ZooKeeper集群中leader和follower之间的同步实际那

&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Jevic</name></author><summary type="html">kafka 参数说明 server.properties配置如下：</summary></entry><entry><title type="html">虚拟专用网络 openvpn</title><link href="http://jevic.cn/2017/12/29/linux-openvpn/" rel="alternate" type="text/html" title="虚拟专用网络 openvpn" /><published>2017-12-29T14:33:17+08:00</published><updated>2017-12-29T14:33:17+08:00</updated><id>http://jevic.cn/2017/12/29/linux-openvpn</id><content type="html" xml:base="http://jevic.cn/2017/12/29/linux-openvpn/">&lt;h2 id=&quot;配置安装环境&quot;&gt;配置安装环境&lt;/h2&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# yum install &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; gcc gcc-c++ pam-devel cmake openssl penssl-devel
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# yum install &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; lrzsz    &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Secure 上传下载&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;## 2.关闭SELINUX、清除防火墙设置&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# vim /etc/selinx/config
&lt;span class=&quot;c&quot;&gt;#     disabled - No SELinux policy is loaded.&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;SELINUX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;disabled
  
&lt;span class=&quot;c&quot;&gt;## 3.开启路由转发功能&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;net.ipv4.ip_forward = 1&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /etc/sysctl.conf
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# sysctl &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
net.ipv4.ip_forward &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1


&lt;span class=&quot;c&quot;&gt;## 4.防火墙规则设置&lt;/span&gt;
Centos7下：
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# systemctl disable firewalld
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# systemctl stop firewalld
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# yum install iptables-services &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# iptables &lt;span class=&quot;nt&quot;&gt;-F&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-F&lt;/span&gt;  （清除所有规则）
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-nL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; iptables &lt;span class=&quot;nt&quot;&gt;-nL&lt;/span&gt;   
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; POSTROUTING &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; 10.8.0.0/24 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; MASQUERADE
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# iptables &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 3307 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT     &lt;span class=&quot;c&quot;&gt;## 3307为服务开放的端口&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# service iptables save
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn openvpn]# iptables &lt;span class=&quot;nt&quot;&gt;-nL&lt;/span&gt;
Chain INPUT &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
target     prot opt &lt;span class=&quot;nb&quot;&gt;source               &lt;/span&gt;destination         
ACCEPT     udp  &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;  0.0.0.0/0            0.0.0.0/0            udp dpt:3307
......
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn openvpn]# iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-nL&lt;/span&gt;
Chain PREROUTING &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
......       
Chain POSTROUTING &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
target     prot opt &lt;span class=&quot;nb&quot;&gt;source               &lt;/span&gt;destination         
MASQUERADE  all  &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;  10.8.0.0/24          0.0.0.0/0 


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;安装-lzo-和-openvpn&quot;&gt;安装 LZO 和 openvpn&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;下载地址：http://pan.baidu.com/s/1kTxS4AF&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# &lt;span class=&quot;nb&quot;&gt;tar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-zxf&lt;/span&gt; lzo-2.06.tar.gz 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# &lt;span class=&quot;nb&quot;&gt;tar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-zxf&lt;/span&gt; openvpn-2.2.2.tar.gz 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]#cd lzo-2.06
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn lzo-2.06]# ./configure &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; make &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# &lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;openvpn-2.2.2
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn openvpn-2.2.2]# &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn openvpn-2.2.2]# ./configure 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn openvpn-2.2.2]# make &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; make install

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;配置openvpn&quot;&gt;配置openVPN&lt;/h2&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# mkdir /etc/openvpn
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# cp &lt;span class=&quot;nt&quot;&gt;-R&lt;/span&gt; openvpn-2.2.2/easy-rsa/ /etc/openvpn/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# &lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc/openvpn/easy-rsa/2.0/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn 2.0]# vi vars 
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;KEY_COUNTRY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CN&quot;&lt;/span&gt; 
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;KEY_PROVINCE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;GD&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;KEY_CITY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SZ&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;KEY_ORG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;YJ&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;KEY_EMAIL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;test@test.cn&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;KEY_EMAIL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;mail@host.domain
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;KEY_CN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;changeme
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;KEY_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;changeme
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;KEY_OU&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;changeme
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PKCS11_MODULE_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;changeme
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PKCS11_PIN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1234
 
 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn 2.0]# &lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt; ./vars
NOTE: If you run ./clean-all, I will be doing a rm &lt;span class=&quot;nt&quot;&gt;-rf&lt;/span&gt; on /etc/openvpn/easy-rsa/2.0/keys
初始化证书授权中心，创建CA证书，输出信息中已经引用了之前所设置的变量值，这里一路回车即可
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn 2.0]# ./clean-all 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn 2.0]# ./build-ca （默认，一路回车即可）
Generating a 1024 bit RSA private key
.............++++++
.......................++++++
&lt;span class=&quot;nt&quot;&gt;-----&lt;/span&gt;
Country Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2 letter code&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;CN]:
State or Province Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;full name&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;GD]:
Locality Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;eg, city&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;SZ]:
Organization Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;eg, company&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;HF]:
Organizational Unit Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;eg, section&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;changeme]:
Common Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;eg, your name or your server&lt;span class=&quot;s1&quot;&gt;'s hostname) [changeme]:
Name [changeme]:
Email Address [mail@host.domain]:

创建Diffie Hellman 参数,Diffie Hellman 用于增强安全性，在OpenVPN是必须的！
[root@openvpn ~]# ./build-dh  

[root@openvpn 2.0]# ./build-key-server server （创建服务器证书和密钥！“server&quot;可以自行设定，这里默认为server）
emailAddress          :IA5STRING:'&lt;/span&gt;mail@host.domain&lt;span class=&quot;s1&quot;&gt;' （前面选项一路回车，下面两项手动输入”y&quot;）
Certificate is to be certified until Jun 13 06:31:17 2025 GMT (3650 days)
Sign the certificate? [y/n]:y
1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated

[root@openvpn 2.0]# ./build-key client （客户端证书和密钥，名称自定义，这里默认也是client）
emailAddress          :IA5STRING:'&lt;/span&gt;mail@host.domain&lt;span class=&quot;s1&quot;&gt;' （前面选项一路回车，下面两项手动输入”y&quot;）
Certificate is to be certified until Jun 13 06:31:43 2025 GMT (3650 days)
Sign the certificate? [y/n]:y      （这两项都是 “y&quot;）
1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated
至此所需证书及密钥都已经生成完毕。


复制服务器证书文件到/etc/openvpn/ 下
[root@openvpn keys]# cp dh1024.pem ca.crt server.crt server.key /etc/openvpn/
[root@openvpn keys]# sz ca.crt client.crt client.key (下载到本地，客户端使用)

复制服务器配置文件到/etc/openvpn下，并编辑添加配置相关参数：
[root@openvpn keys]# cp /root/openvpn-2.2.2/sample-config-files/server.conf  /etc/openvpn/server.conf
[root@openvpn keys]# vi /etc/openvpn/server.conf
local 10.1.50.222    # VPN服务器地址
port 3307    # 端口号
proto udp  # 协议类型
dev tun
ca /etc/openvpn/ca.crt
cert /etc/openvpn/ltyserver.crt
key /etc/openvpn/ltyserver.key  # This file should be kept secret
dh /etc/openvpn/dh1024.pem
server 10.8.0.0 255.255.255.0  #vpn客户端地址段
ifconfig-pool-persist ipp.txt
push &quot;route 10.1.50.0 255.255.0.0&quot;
push &quot;route 10.1.10.0 255.255.0.0&quot;
push &quot;redirect-gateway&quot;   #使客户端的默认网关指向VPN,所有连接从VPN转发
push &quot;dhcp-option DNS 10.1.254.1&quot;
push &quot;dhcp-option DNS 202.96.134.133&quot;
keepalive 10 120
comp-lzo
persist-key
persist-tun
status openvpn-status.log
verb 3
#吊销证书参数 初始安装时无需设置,否则报错无法启动
;crl-verify /etc/openvpn/easy-rsa/2.0/keys/crl.pem  


[root@openvpn keys]# openvpn --config /etc/openvpn/server.conf       启动服务
.....................................................
Tue Jun 16 03:11:17 2015 Initialization Sequence Completed （初始化顺序完成）
服务端配置完成，启动程序，查看是否监听3307的udp端口
默认为udp，并且看到多出来一块网卡tun0，IP为10.8.0.1

添加开机自启：
[root@openvpn ~]# grep &quot;openvpn&quot; /etc/rc.d/rc.local 
/usr/local/sbin/openvpn --daemon --config /etc/openvpn/server.conf

下载客户端证书、密钥、客户端配置文件
[root@openvpn ]# sz openvpn-2.2.2/sample/sample-config-files/client.conf
修改以下4项配置：
remote x.x.x.x 3307
ca ca.crt
cert client.crt
key client.key

&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;客户端证书文件脚本&quot;&gt;客户端证书文件脚本&lt;/h2&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@ ~]# &lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/openvpn/easy-rsa/2.0/autoclientkey.sh
&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## 创建用户证书文件&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;PWD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/etc/openvpn/easy-rsa/2.0
&lt;span class=&quot;nv&quot;&gt;KONG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;n&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$PWD&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;## 创建证书文件&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; vars
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;sleep 1
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$KONG&lt;/span&gt;
sleep 1
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$KONG&lt;/span&gt;
sleep 1
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$KONG&lt;/span&gt;
sleep 1
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$KONG&lt;/span&gt;
sleep 1
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$KONG&lt;/span&gt;
sleep 1
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;y&quot;&lt;/span&gt;
sleep 1
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;y&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;|./build-key &lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;keys/
&lt;span class=&quot;c&quot;&gt;## 修改客户端配置文件&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## cp openvpn-2.2.2/sample-config-files/client.conf /etc/openvpn/easy-rsa/2.0/keys/client.ovpn&lt;/span&gt;
sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;s/client.crt/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.crt/g&quot;&lt;/span&gt; client.ovpn
sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;s/client.key/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.key/g&quot;&lt;/span&gt; client.ovpn

&lt;span class=&quot;c&quot;&gt;## 打包文件并sz上传到本地&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## &lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;tar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-zcvf&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;.tar.gz &lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;.crt &lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;.key ca.crt client.ovpn
sz &lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;.tar.gz

&lt;span class=&quot;c&quot;&gt;## 恢复默认客户端配置文件&lt;/span&gt;
sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;s/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/client/g&quot;&lt;/span&gt; client.ovpn
sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;s/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/client/g&quot;&lt;/span&gt; client.ovpn

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;常用操作&quot;&gt;常用操作&lt;/h2&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
删除账号
注销用户证书
1. 进入 OpenVPN 安装目录
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# &lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc/openvpn/easy-rsa/2.0/ 
2. 执行 vars 命令 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; ./var
3. 使用 revoke-full 命令，吊销客户端证书。命令格式为： 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# ./revoke-full client1 
这条命令执行完成之后，会在 keys 目录下面，生成一个 crl.pem 文件，这个文件中包含了吊销证书的名单。 
成功注销某个证书之后，可以打开　keys/index.txt 文件，可以看到被注销的证书前面，已标记为R． 
4. 确保服务端配置文件打开了 crl-verify 选项 
在服务端的配置文件 server.conf 中，加入这样一行： 
如果 server.conf 文件和 crl.pem 没有在同一目录下面，则 crl.pem 应该写绝对路径，例如: 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@openvpn ~]# &lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/openvpn/server.conf
crl-verify  /openvpn-2.0.5/easy-rsa/2.0/keys/crl.pem 

访问控制
iptables &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; FORWARD &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; tun0 &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; 10.10.10.0/30 &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; 10.10.10.4 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
意思是只允许10.10.10.0网段的IP访问10.10.10.4，如许访问多个IP，及添加多条命令即可。

Openvpn的负载均衡和高可用
搭建另一台openvpn服务器，将原来的ca.crt  ca.key server.key server.crt server.csr 复制到/etc/openvpn 目录下,在客户端配置文件当中添加3条命令：
remote 192.168.3.96 1195  &lt;span class=&quot;c&quot;&gt;#openvpn 服务器ip&lt;/span&gt;
remote-random   &lt;span class=&quot;c&quot;&gt;#开启远程随机服务器&lt;/span&gt;
resolv-retry 60   &lt;span class=&quot;c&quot;&gt;#开启断开重连60s&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;转载请注明出处，本文采用 &lt;a href=&quot;http://creativecommons.org/licenses/by-nc-nd/4.0/&quot;&gt;CC4.0&lt;/a&gt; 协议授权&lt;/p&gt;</content><author><name>Jevic</name></author><summary type="html">配置安装环境</summary></entry><entry><title type="html">sublimeText3 插件配置快捷操作</title><link href="http://jevic.cn/2017/12/29/sublimetext3/" rel="alternate" type="text/html" title="sublimeText3 插件配置快捷操作" /><published>2017-12-29T13:07:51+08:00</published><updated>2017-12-29T13:07:51+08:00</updated><id>http://jevic.cn/2017/12/29/sublimetext3</id><content type="html" xml:base="http://jevic.cn/2017/12/29/sublimetext3/">&lt;h2 id=&quot;sublimetext3-for-mac-os&quot;&gt;SublimeText3 for Mac OS&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;p&gt;工欲善其事必先利其器&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;禁止自动更新&quot;&gt;禁止自动更新&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;http://ourpypwzb.bkt.clouddn.com/sublimeText_User.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;添加 “update_check”: false,&lt;/li&gt;
  &lt;li&gt;点击菜单栏 Help –&amp;gt; license 输入以下注册信息&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;—– BEGIN LICENSE —–
Michael Barnes
Single User License
EA7E-821385
8A353C41 872A0D5C DF9B2950 AFF6F667
C458EA6D 8EA3C286 98D1D650 131A97AB
AA919AEC EF20E143 B361B1E7 4C8B7F04
B085E65E 2F5F5360 8489D422 FB8FC1AA
93F6323C FD7F7544 3F39C318 D95E6480
FCCC7561 8A4A1741 68FA4223 ADCEDE07
200C25BE DBBC4855 C4CFB774 C5EC138C
0FEC1CEF D9DCECEC D3A5DAD1 01316C36
—— END LICENSE ——
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;安装-package-control&quot;&gt;安装 Package Control&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;p&gt;所有插件都需要使用此工具来进行安装!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ol&gt;
  &lt;li&gt;打开 Sublime Text 3&lt;/li&gt;
  &lt;li&gt;点击顶部菜单的 View -&amp;gt; Show Console&lt;/li&gt;
  &lt;li&gt;输入以下代码或者直接访问此链接获取 https://packagecontrol.io/installation#st3&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import urllib.request,os,hashlib; h = 'df21e130d211cfc94d9b0905775a7c0f' + '1e3d39e33b79698005270310898eea76'; pf = 'Package Control.sublime-package'; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); by = urllib.request.urlopen( 'http://packagecontrol.io/' + pf.replace(' ', '%20')).read(); dh = hashlib.sha256(by).hexdigest(); print('Error validating download (got %s instead of %s), please try manual install' % (dh, h)) if dh != h else open(os.path.join( ipp, pf), 'wb' ).write(by)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;http://ourpypwzb.bkt.clouddn.com/package01.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;点击回车 安装完后即可通过 &lt;code class=&quot;highlighter-rouge&quot;&gt;Command + Shift + P&lt;/code&gt; 打开 Package Control 来安装插件&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;http://ourpypwzb.bkt.clouddn.com/package02.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1&gt;#&lt;/h1&gt;

&lt;h2 id=&quot;插件&quot;&gt;插件&lt;/h2&gt;
&lt;h3 id=&quot;推荐插件&quot;&gt;推荐插件&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;Emmet 概括的说，Emmet(其前身是Zen Coding) 是一个可以让你更快更高效地编写HTML/CSS，可以节省你大量时间的插件。 
调用Emmet快捷键：⌃⌥↩。&lt;/li&gt;
  &lt;li&gt;Git 这个插件会将git整合进你的SublimeText，使的你可以在SublimeText中运行Git命令，包括添加，提交文件，查看日志，文件注解以及其它Git功能。&lt;/li&gt;
  &lt;li&gt;AutoFileName 自动补全文件路径，非常方便。&lt;/li&gt;
  &lt;li&gt;DocBlockr DocBlockr会成为你编写代码文档的有效工具。当输入/**并且按下Tab键的时候，这个插件会自动解析任何一个函数并且为你准备好合适的模板&lt;/li&gt;
  &lt;li&gt;SFTP 快速编辑远程服务器文件&lt;/li&gt;
  &lt;li&gt;SublimeLinter 行内语法检测插件，支持： C/C++, Java, Python, PHP, js, HTML, CSS, etc.&lt;/li&gt;
  &lt;li&gt;Alignment 简单到极致的多行选择和多行选择对齐插件&lt;/li&gt;
  &lt;li&gt;Markdown-preview Markdown&lt;/li&gt;
  &lt;li&gt;ChineseLocalization Sublime 汉化插件&lt;/li&gt;
  &lt;li&gt;Anaconda Python&lt;/li&gt;
  &lt;li&gt;ctags
    &lt;h3 id=&quot;view-html插件&quot;&gt;view HTML插件&lt;/h3&gt;
    &lt;ul&gt;
      &lt;li&gt;shift + command + p&lt;/li&gt;
      &lt;li&gt;输入pcip 选择Install Package并回车&lt;/li&gt;
      &lt;li&gt;view 回车安装&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[  
{ &quot;keys&quot;: [&quot;f2&quot;], &quot;command&quot;: &quot;open_in_browser&quot; },
]

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://ourpypwzb.bkt.clouddn.com/viewhtml_01.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://ourpypwzb.bkt.clouddn.com/viewhtml_02.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://ourpypwzb.bkt.clouddn.com/viewhtml_set_03.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://ourpypwzb.bkt.clouddn.com/viewhtml_key_04.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;浏览markdown文件&quot;&gt;浏览markdown文件&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;Command + Shift + P&lt;/li&gt;
  &lt;li&gt;pcip&lt;/li&gt;
  &lt;li&gt;mp&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;python-必备&quot;&gt;Python 必备&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;anaconda&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;color_scheme&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;Packages/Color Scheme - Default/Monokai.tmTheme&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;font_size&quot;&lt;/span&gt;: 14,
    &lt;span class=&quot;s2&quot;&gt;&quot;ignored_packages&quot;&lt;/span&gt;:
    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;Vintage&quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;anaconda_linting&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;## 取消Python 编写时白色框框提示&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;sublimetext3-for-mac-os-常用快捷键&quot;&gt;SublimeText3 for Mac OS 常用快捷键&lt;/h2&gt;
&lt;h3 id=&quot;符号说明&quot;&gt;符号说明&lt;/h3&gt;

&lt;p&gt;⌘：command 
⌃：control 
⌥：option 
⇧：shift 
↩：enter 
⌫：delete 
打开/关闭/前往&lt;/p&gt;

&lt;h4 id=&quot;快捷键-功能&quot;&gt;快捷键 功能&lt;/h4&gt;
&lt;p&gt;⌘⇧N 打开一个新的sublime窗口 
⌘N 新建文件 
⌘⇧W 关闭sublime，关闭所有文件 
⌘W 关闭当前文件 
⌘P 跳转、前往文件、前往项目、命令提示、前往method等等（Goto anything） 
⌘⇧T 重新打开最近关闭的文件 
⌘T 前往文件 
⌘⌃P 前往项目 
⌘R 前往method 
⌘⇧P 命令提示 
⌃G 前往行 
⌘KB 开关侧栏 
⌃` 打开控制台 
⌃- 光标跳回上一个位置 
⌃⇧- 光标恢复位置&lt;/p&gt;
&lt;h4 id=&quot;快捷键-编辑&quot;&gt;快捷键 编辑&lt;/h4&gt;

&lt;p&gt;⌘A 全选 
⌘L 选择行（重复按下将下一行加入选择） 
⌘D 选择词（重复按下时多重选择相同的词进行多重编辑） 
⌃⇧M 选择括号的内容 
⌘⇧↩ 在当前行前插入新行 
⌘↩ 在当前行后插入新行 
⌃⇧K 删除行 
⌘KK 从光标处删除至行尾 
⌘K⌫ 从光标处删除至行首 
⌘⇧D 复制（多）行 
⌘J 合并（多）行 
⌘KU 改为大写 
⌘KL 改为小写 
⌘C 复制 
⌘X 剪切 
⌘V 粘贴 
⌘/ 注释 
⌘⌥/ 块注释 
⌘Z 撤销 
⌘Y 恢复撤销 
⌘⇧V 粘贴并自动缩进 
⌘⌥V 从历史中选择粘贴 
⌃M 跳转至对应的括号 
⌘U 软撤销（可撤销光标移动） 
⌘⇧U 软重做（可重做光标移动） 
⌘⇧S 保存所有文件 
⌘] 向右缩进 
⌘[ 向左缩进 
⌘⌥T 特殊符号集 
⌘⇧L 将选区转换成多个单行选区&lt;/p&gt;

&lt;h4 id=&quot;查找替换&quot;&gt;查找/替换&lt;/h4&gt;
&lt;p&gt;⌘f 查找 
⌘⌥f 查找并替换 
⌘⌥g 查找下一个符合当前所选的内容 
⌘⌃g 查找所有符合当前选择的内容进行多重编辑 
⌘⇧F 在所有打开的文件中进行查找&lt;/p&gt;
&lt;h4 id=&quot;拆分窗口标签页&quot;&gt;拆分窗口/标签页&lt;/h4&gt;

&lt;p&gt;⌘⌥[1,2,3,4] 单列、双列、三列、四列 
⌘⌥5 网格（4组） 
⌃[1,2,3,4] 焦点移动到相应的组（分屏编号） 
⌃⇧[1,2,3,4] 将当前文件移动到相应的组（分屏编号） 
⌘[1,2,3,4] 选择相应的标签页&lt;/p&gt;
&lt;h4 id=&quot;快捷操作&quot;&gt;快捷操作&lt;/h4&gt;

&lt;p&gt;⌘⌃上下键 两行交换位置 
⌘KB 显示/隐藏侧边&lt;/p&gt;

&lt;p&gt;转载请注明出处，本文采用 &lt;a href=&quot;http://creativecommons.org/licenses/by-nc-nd/4.0/&quot;&gt;CC4.0&lt;/a&gt; 协议授权&lt;/p&gt;</content><author><name>Jevic</name></author><summary type="html">SublimeText3 for Mac OS 工欲善其事必先利其器</summary></entry><entry><title type="html">jenkens-gitlab-docker 自动化构建镜像(一)</title><link href="http://jevic.cn/2017/12/26/docker-jenkins-gitlab-images/" rel="alternate" type="text/html" title="jenkens-gitlab-docker 自动化构建镜像(一)" /><published>2017-12-26T21:51:44+08:00</published><updated>2017-12-26T21:51:44+08:00</updated><id>http://jevic.cn/2017/12/26/docker-jenkins-gitlab-images</id><content type="html" xml:base="http://jevic.cn/2017/12/26/docker-jenkins-gitlab-images/">&lt;blockquote&gt;
  &lt;ul&gt;
    &lt;li&gt;gitlab来管理dockerfile 源码&lt;/li&gt;
    &lt;li&gt;使用jenkins来构建部署应用的docker 镜像并自动push到私有仓库
      &lt;ul&gt;
        &lt;li&gt;通过执行相关自定义操作来进行应用的自动测试、部署应用操作&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/li&gt;
    &lt;li&gt;进而减少不必要的人为手动操作,驱动自动化的应用部署极大提升效率,实现持续集成与构建!&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;此示例演示了镜像的自动构建操作，更多的例如自动部署应用 后续补充……&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;安装-docker&quot;&gt;安装 Docker&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;省略…… 请自行查看docker官方文档&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;运行jenkins&quot;&gt;运行Jenkins&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;https://hub.docker.com/r/jevic/jenkins/&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; jenkins &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 8080:8080 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 50000:50000 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; /data/ci/jenkins:/var/jenkins_home &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; /var/run/docker.sock:/var/run/docker.sock &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
jevic/jenkins:docker-latest
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;运行gitlab-ce-中文社区版-9x-版本&quot;&gt;运行gitlab-ce 中文社区版 (9.x 版本)&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;https://hub.docker.com/r/twang2218/gitlab-ce-zh/&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;version: '2'
services:
    gitlab:
      image: 'twang2218/gitlab-ce-zh:9.2.10'
      restart: unless-stopped
      hostname: 'gitlab.jevic.cn'
      environment:
        TZ: 'Asia/Shanghai'
      ports:
        - '80:80'
        - '443:443'
        - '22:22'
      volumes:
        - config:/etc/gitlab
        - data:/var/opt/gitlab
        - logs:/var/log/gitlab
volumes:
    config:
    data:
    logs:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;配置jenkins&quot;&gt;配置jenkins&lt;/h2&gt;

&lt;h3 id=&quot;安装插件&quot;&gt;安装插件&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/jenkins-docker-plugin.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/jenkins-gitlab-plugs.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;系统设置&quot;&gt;系统设置&lt;/h3&gt;

&lt;h4 id=&quot;配置私有仓库地址以及认证信息&quot;&gt;配置私有仓库地址以及认证信息&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/jenkins-registry-user.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;设置docker-服务&quot;&gt;设置docker 服务&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;新增一个云  选择 docker&lt;/li&gt;
  &lt;li&gt;unix:///var/run/docker.sock
&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/jenkins-docker-cloud.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;获取用户token&quot;&gt;获取用户Token&lt;/h4&gt;

&lt;p&gt;返回主面板 -&amp;gt; 用户 -&amp;gt; 点击admin -&amp;gt; 设置&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/jenkins-admon-token.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;创建任务&quot;&gt;创建任务&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/jenkins-jobs-01.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h5 id=&quot;源码管理&quot;&gt;源码管理&lt;/h5&gt;
&lt;p&gt;&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/jenkins-gitlab-nginx-master.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;触发器&quot;&gt;触发器&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;触发远程构建 钩子&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Use the following URL to trigger build remotely:
JENKINS_URL/job/webhook/build?token=TOKEN_NAME 或者 
/buildWithParameters?token=TOKEN_NAME&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/jenkins-chufaqi.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;构建环境默认&quot;&gt;构建环境默认&lt;/h5&gt;
&lt;h5 id=&quot;构建&quot;&gt;构建&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;以构建次数为标签 hub.jevic.com/nginx/nginx:${BUILD_NUMBER}
&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/jenkins-docker-build.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;gitlab-项目配置&quot;&gt;gitlab 项目配置&lt;/h2&gt;

&lt;h3 id=&quot;创建新的项目-nginx&quot;&gt;创建新的项目 nginx&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;例如: http://jevic@gitlab.jevic.cn/jevic/nginx.git&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;设置---集成webhook&quot;&gt;设置 -&amp;gt; 集成webhook&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;URL 格式如下:
    &lt;ul&gt;
      &lt;li&gt;http://ci.jevic.cn/buildByToken/build?job=webhook&amp;amp;token=[API-TOKEN]&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;示例:
    &lt;ul&gt;
      &lt;li&gt;http://ci.jevic.cn:8080/buildByToken/build?job=webhook&amp;amp;token=494e32323dfsdfaeb0c49f8sdfa232615&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/jenkins-gitlab-webhook.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;测试
&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/jenkins-gitlab-webhook-02.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;运行任务&quot;&gt;运行任务&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;push 代码到仓库&lt;/li&gt;
  &lt;li&gt;查看jenkins 构建任务运行状态&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;工作目录
[root@jevic.cn webhook]# pwd
/data/ci/jenkins/workspace/webhook
[root@jevic.cn webhook]# ls
Dockerfile  README.md

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/jenkens-webhook-jobs-ok%20%281%29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;查看仓库
&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/jenkins-registry-harbor.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;转载请注明出处，本文采用 &lt;a href=&quot;http://creativecommons.org/licenses/by-nc-nd/4.0/&quot;&gt;CC4.0&lt;/a&gt; 协议授权&lt;/p&gt;</content><author><name>Jevic</name></author><summary type="html">gitlab来管理dockerfile 源码 使用jenkins来构建部署应用的docker 镜像并自动push到私有仓库 通过执行相关自定义操作来进行应用的自动测试、部署应用操作 进而减少不必要的人为手动操作,驱动自动化的应用部署极大提升效率,实现持续集成与构建!</summary></entry><entry><title type="html">Zabbix Docker运行及报警监控</title><link href="http://jevic.cn/2017/12/02/linux-zabbix-docker-install/" rel="alternate" type="text/html" title="Zabbix Docker运行及报警监控" /><published>2017-12-02T16:50:24+08:00</published><updated>2017-12-02T16:50:24+08:00</updated><id>http://jevic.cn/2017/12/02/linux-zabbix-docker-install</id><content type="html" xml:base="http://jevic.cn/2017/12/02/linux-zabbix-docker-install/">&lt;h2 id=&quot;zabbix&quot;&gt;Zabbix&lt;/h2&gt;
&lt;p&gt;使用官方Docker 镜像运行Zabbix 
&lt;a href=&quot;https://github.com/jevic/docker/tree/master/zabbix&quot;&gt;docker-compose&lt;/a&gt; 编排文件&lt;/p&gt;

&lt;h4 id=&quot;server-配置&quot;&gt;Server 配置&lt;/h4&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@zabbix etc]# &lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;zabbix_server.conf
&lt;span class=&quot;nv&quot;&gt;PidFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/tmp/zabbix_server.pid
&lt;span class=&quot;nv&quot;&gt;LogFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/tmp/zabbix_server.log
&lt;span class=&quot;nv&quot;&gt;DBHost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;x.x.x.x
&lt;span class=&quot;nv&quot;&gt;DBName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;zabbix
&lt;span class=&quot;nv&quot;&gt;DBUser&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;zabbix
&lt;span class=&quot;nv&quot;&gt;DBPassword&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;zabbix_pwd
&lt;span class=&quot;nv&quot;&gt;DBSocket&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/tmp/mysql.sock
&lt;span class=&quot;nv&quot;&gt;Include&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local/zabbix/etc/zabbix_server.conf.d/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.conf
&lt;span class=&quot;nv&quot;&gt;StartPollers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;16
&lt;span class=&quot;nv&quot;&gt;SNMPTrapperFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/var/log/snmptrap/snmptrap.log
&lt;span class=&quot;nv&quot;&gt;Timeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4
&lt;span class=&quot;nv&quot;&gt;AlertScriptsPath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local/zabbix/share/zabbix/alertscripts
&lt;span class=&quot;nv&quot;&gt;ExternalScripts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local/zabbix/share/zabbix/externalscripts
&lt;span class=&quot;nv&quot;&gt;LogSlowQueries&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3000

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;报警设置&quot;&gt;报警设置&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/jevic/wxalarm&quot;&gt;报警接口应用&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/zabbix01.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/zabbix02.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/zabbix03.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/zabbix04.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1. 脚本参数:
{ALERT.SUBJECT}
{ALERT.MESSAGE}

2. 动作:
默认接收人: 
服务器:{HOSTNAME1}发生: {TRIGGER.NAME} 故障!
告警主机:{HOSTNAME1}
告警时间:{EVENT.DATE} {EVENT.TIME}
告警等级:{TRIGGER.SEVERITY}
告警信息: {TRIGGER.NAME}
告警项目:{TRIGGER.KEY1}
问题详情:{ITEM.NAME}:{ITEM.VALUE}

服务器:{HOSTNAME1}: {TRIGGER.NAME}已恢复!
告警主机:{HOSTNAME1}
告警时间:{EVENT.DATE} {EVENT.TIME}
告警等级:{TRIGGER.SEVERITY}
告警信息: {TRIGGER.NAME}
告警项目:{TRIGGER.KEY1}
问题详情:{ITEM.NAME}:{ITEM.VALUE}


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;模板&quot;&gt;模板&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;https://monitoringartist.github.io/zabbix-searcher/#&lt;/li&gt;
  &lt;li&gt;模板 -&amp;gt; 应用集 -&amp;gt; 监控项 -&amp;gt; 触发器&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/zabbix-temlpate-01.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/zabbix-template-02.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/zabbix-template-03.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;http://ok6h8mla5.bkt.clouddn.com/zabbix-template-04.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;触发器多参数示例&quot;&gt;触发器多参数示例&lt;/h3&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{Template  DT general  monitor for 302:ngx_status[count,499].last()}&amp;gt;10

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;agent-配置文件&quot;&gt;agent 配置文件&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;UserParameter=chk_timezone,if [ `date +%Z` != CST ];then echo 0 ;else echo 1;fi
UserParameter=tcp_status[*],/data/script/tcp_status.sh $1
UserParameter=chk_kt_rsync,/data/script/chk_kt_sync.sh
UserParameter=chk_openfile,/usr/sbin/lsof -n|wc -l
UserParameter=ngx_status[*],/data/script/ngx_status.sh $1 $2
UserParameter=chk_nginx_process,/bin/ps -ef|grep nginx|grep -v grep|wc -l
UserParameter=chk_io_usage,/usr/bin/iostat -x 1 2 | /usr/bin/perl -lane '$cnt++ and next if /Device/; $max &amp;lt; $F[-1] and $max = $F[-1] if $cnt &amp;gt; 1; END{ print $max || 0.00 }'
UserParameter=find_disk,/data/script/find_disk.sh
UserParameter=chk_disk_io[*],/data/script/chk_disk_io.sh $1 $2
UserParameter=chk_thread[*],/data/script/chk_thread.sh $1

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Jevic</name></author><summary type="html">Zabbix 使用官方Docker 镜像运行Zabbix docker-compose 编排文件</summary></entry><entry><title type="html">Kafka Zookeeper 操作杂录</title><link href="http://jevic.cn/2017/09/12/kafka-zk-conf/" rel="alternate" type="text/html" title="Kafka Zookeeper 操作杂录" /><published>2017-09-12T17:35:11+08:00</published><updated>2017-09-12T17:35:11+08:00</updated><id>http://jevic.cn/2017/09/12/kafka-zk-conf</id><content type="html" xml:base="http://jevic.cn/2017/09/12/kafka-zk-conf/">&lt;blockquote&gt;
  &lt;p&gt;zookeeper kafka 杂录
日常使用操作记录及故障处理记录&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;zookeeper&quot;&gt;zookeeper&lt;/h2&gt;
&lt;h3 id=&quot;可视化日志&quot;&gt;可视化日志&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;java -cp zookeeper-3.4.9.jar:lib/slf4j-api-1.6.1.jar:lib/slf4j-log4j12-1.6.1.jar:lib/log4j-1.2.16.jar:conf org.apache.zookeeper.server.LogFormatter /data/zookeeper/version-2/log.100000001
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;可视化快照&quot;&gt;可视化快照&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;java -cp zookeeper-3.4.9.jar:lib/slf4j-api-1.6.1.jar org.apache.zookeeper.server.SnapshotFormatter /data/zookeeper/version-2/snapshot.100000030

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;数据清理&quot;&gt;数据清理&lt;/h3&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1. 使用自带命令
zkCleanup.sh /datac/zk_data/version-2  20
/datac/zk_data/version-2 指的是存放快照和log文件的目录
20 代表保留最近20份数据

2. 设定定时任务脚本
保留最新的66个文件
&lt;span class=&quot;c&quot;&gt;#!/bin/bash &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#snapshot file dir &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;dataDir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/home/test/zk_data/version-2 
&lt;span class=&quot;c&quot;&gt;#tran log dir &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;dataLogDir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/home/test/zk_log/version-2 
&lt;span class=&quot;c&quot;&gt;#zk log dir &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;logDir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/home/test/logs 
&lt;span class=&quot;c&quot;&gt;#Leave 66 files &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;66 
&lt;span class=&quot;nv&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$[$count&lt;/span&gt;+1] 
&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$dataLogDir&lt;/span&gt;/log.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; | tail &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; +&lt;span class=&quot;nv&quot;&gt;$count&lt;/span&gt; | xargs rm &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; 
&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$dataDir&lt;/span&gt;/snapshot.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; | tail &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; +&lt;span class=&quot;nv&quot;&gt;$count&lt;/span&gt; | xargs rm &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; 
&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$logDir&lt;/span&gt;/zookeeper.log.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; | tail &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; +&lt;span class=&quot;nv&quot;&gt;$count&lt;/span&gt; | xargs rm &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt;


3. 配置文件中指定参数
autopurge.purgeInterval  这个参数指定了清理频率，单位是小时，需要填写一个1或更大的整数，默认是0，表示不开启自己清理功能。
autopurge.snapRetainCount 这个参数和上面的参数搭配使用，这个参数指定了需要保留的文件数目。默认是保留3个
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;kafka&quot;&gt;kafka&lt;/h2&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; bin/kafka-console-consumer.sh &lt;span class=&quot;nt&quot;&gt;--zookeeper&lt;/span&gt; localhost:2181/kafka &lt;span class=&quot;nt&quot;&gt;--from-beginning&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--topic&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;test

&lt;/span&gt;2.10
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; ./kafka-console-consumer.sh &lt;span class=&quot;nt&quot;&gt;--bootstrap-server&lt;/span&gt; localhost:9092 &lt;span class=&quot;nt&quot;&gt;--topic&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; ./kafka-console-producer.sh &lt;span class=&quot;nt&quot;&gt;--broker-list&lt;/span&gt; localhost:9092 &lt;span class=&quot;nt&quot;&gt;--topic&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;


&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; bin/kafka-topics.sh &lt;span class=&quot;nt&quot;&gt;--create&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--zookeeper&lt;/span&gt; localhost:2181 &lt;span class=&quot;nt&quot;&gt;--replication-factor&lt;/span&gt; 1 &lt;span class=&quot;nt&quot;&gt;--partitions&lt;/span&gt; 1 &lt;span class=&quot;nt&quot;&gt;--topic&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; bin/kafka-topics.sh &lt;span class=&quot;nt&quot;&gt;--list&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--zookeeper&lt;/span&gt; localhost:2181
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; bin/kafka-topics.sh &lt;span class=&quot;nt&quot;&gt;--delete&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--topic&lt;/span&gt; ngx-logs &lt;span class=&quot;nt&quot;&gt;--zookeeper&lt;/span&gt; kafka1:2181
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; bin/kafka-consumer-groups.sh &lt;span class=&quot;nt&quot;&gt;--bootstrap-server&lt;/span&gt; broker1:9092 &lt;span class=&quot;nt&quot;&gt;--list&lt;/span&gt; logstash

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;kafka-集群扩展&quot;&gt;kafka 集群扩展:&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://kafka.apache.org/documentation/#basic_ops_automigrate&quot;&gt;官方文档&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
--generate: 生成
--execute:  执行
--verify:   查看

1. 编辑topic 分区文件
  &amp;gt; cat topics-to-move.json
  {&quot;topics&quot;: [{&quot;topic&quot;: &quot;foo1&quot;},
              {&quot;topic&quot;: &quot;foo2&quot;}],
  &quot;version&quot;:1
  }

2. 生成分布文件
[root@kafka1 kafka]# ./bin/kafka-reassign-partitions.sh --zookeeper kafka1:2181 --topics-to-move-json-file topics-to-move.json --broker-list &quot;3,4&quot; --generate
Current partition replica assignment

{&quot;version&quot;:1,&quot;partitions&quot;:[{&quot;topic&quot;:&quot;nginx302a&quot;,&quot;partition&quot;:4,&quot;replicas&quot;:[1,3]},{&quot;topic&quot;:&quot;nginx302a&quot;,&quot;partition&quot;:3,&quot;replicas&quot;:[0,2]},{&quot;topic&quot;:&quot;nginx302a&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[2,4]},{&quot;topic&quot;:&quot;nginx302a&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[3,0]},{&quot;topic&quot;:&quot;nginx302a&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[4,1]}]}
Proposed partition reassignment configuration  [将下面部分复制保存到文件]

{&quot;version&quot;:1,&quot;partitions&quot;:[{&quot;topic&quot;:&quot;nginx302a&quot;,&quot;partition&quot;:4,&quot;replicas&quot;:[3,4]},{&quot;topic&quot;:&quot;nginx302a&quot;,&quot;partition&quot;:3,&quot;replicas&quot;:[4,3]},{&quot;topic&quot;:&quot;nginx302a&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[3,4]},{&quot;topic&quot;:&quot;nginx302a&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[4,3]},{&quot;topic&quot;:&quot;nginx302a&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[3,4]}]}


3. 执行移动分片
 &amp;gt; bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file expand-cluster-reassignment.json --execute

4.  查看运行结果 
&amp;gt; bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file expand-cluster-reassignment.json --verify


对于分区文件可以手动定义

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;文件系统&quot;&gt;文件系统&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Ext4
    &lt;ol&gt;
      &lt;li&gt;data=writeback&lt;/li&gt;
      &lt;li&gt;Disabling journaling&lt;/li&gt;
      &lt;li&gt;commit=num_secs&lt;/li&gt;
      &lt;li&gt;nobh&lt;/li&gt;
      &lt;li&gt;delalloc&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;示例&quot;&gt;示例:&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./bin/kafka-reassign-partitions.sh --zookeeper kafka0.yfcloud:2181,kafka1.yfcloud:2181,kafka2.yfcloud:2181,kafka3.yfcloud:2181,kafka4.yfcloud:2181/kafka --reassignment-json-file reass.json --verify


./bin/kafka-topics.sh --describe --topic ngx302 --zookeeper kafka0.yfcloud:2181,kafka1.yfcloud:2181,kafka2.yfcloud:2181,kafka3.yfcloud:2181,kafka4.yfcloud:2181/kafka

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;集群数据均衡失效处理&quot;&gt;集群数据均衡失效处理&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kafka manager:
Yikes! Partition reassignment currently in progress for

get /kafka/admin/reassign_partitions
rmr /kafka/admin/reassign_partitions
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Jevic</name></author><summary type="html">zookeeper kafka 杂录 日常使用操作记录及故障处理记录</summary></entry><entry><title type="html">Linux history 历史命令增强显示</title><link href="http://jevic.cn/2017/08/08/linux-history-shell/" rel="alternate" type="text/html" title="Linux history 历史命令增强显示" /><published>2017-08-08T20:57:22+08:00</published><updated>2017-08-08T20:57:22+08:00</updated><id>http://jevic.cn/2017/08/08/linux-history-shell</id><content type="html" xml:base="http://jevic.cn/2017/08/08/linux-history-shell/">&lt;blockquote&gt;
  &lt;p&gt;默认的history 信息只能看到执行命令而无法得知登陆来源ip以及命令执行时间,
进而为了更加明了的查看主机的操作信息以及操作”证据”的获取，对所有服务器history 显示信息进行了自定义设置…&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# /etc/profile&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# System wide environment and startup programs, for login setup&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Functions and aliases go in /etc/bashrc&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# It's NOT a good idea to change this file unless you know what you&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# are doing. It's much better to create a custom.sh shell script in&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# /etc/profile.d/ to make custom changes to your environment, as this&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# will prevent the need for merging in future updates.&lt;/span&gt;

pathmunge &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;:&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$2&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
                &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;:&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;else
                &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;:&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;fi
    esac&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-x&lt;/span&gt; /usr/bin/id &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-z&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EUID&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;# ksh workaround&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;EUID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;id &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;UID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;id &lt;span class=&quot;nt&quot;&gt;-ru&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fi
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;USER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;id &lt;span class=&quot;nt&quot;&gt;-un&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;LOGNAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$USER&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;MAIL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/var/spool/mail/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$USER&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Path manipulation&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EUID&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;pathmunge /usr/sbin
    pathmunge /usr/local/sbin
&lt;span class=&quot;k&quot;&gt;else
    &lt;/span&gt;pathmunge /usr/local/sbin after
    pathmunge /usr/sbin after
&lt;span class=&quot;k&quot;&gt;fi

&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;HOSTNAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;/usr/bin/hostname 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;HISTSIZE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1000
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$HISTCONTROL&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ignorespace&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;HISTCONTROL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ignoreboth
&lt;span class=&quot;k&quot;&gt;else
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;HISTCONTROL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ignoredups
&lt;span class=&quot;k&quot;&gt;fi

&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL

&lt;span class=&quot;c&quot;&gt;# By default, we want umask to get set. This sets it for login shell&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Current threshold for system reserved uid/gids is 200&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# You could check uidgid reservation validity in&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# /usr/share/doc/setup-*/uidgid file&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$UID&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-gt&lt;/span&gt; 199 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;id &lt;span class=&quot;nt&quot;&gt;-gn&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;id &lt;span class=&quot;nt&quot;&gt;-un&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;umask &lt;/span&gt;002
&lt;span class=&quot;k&quot;&gt;else
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;umask &lt;/span&gt;022
&lt;span class=&quot;k&quot;&gt;fi

for &lt;/span&gt;i &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; /etc/profile.d/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.sh &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do
    if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-#*i&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$-&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt; 
            &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/dev/null
        &lt;span class=&quot;k&quot;&gt;fi
    fi
done

&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unset &lt;/span&gt;i
&lt;span class=&quot;nb&quot;&gt;unset&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; pathmunge


&lt;span class=&quot;c&quot;&gt;## 设置history格式&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;HISTTIMEFORMAT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;[%Y-%m-%d %H:%M:%S] [&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;who am i 2&amp;gt;/dev/null| awk &lt;span class=&quot;s1&quot;&gt;'{print $NF}'&lt;/span&gt;|sed &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'s/[()]//g'&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;] &quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## 实时记录用户在shell中执行的每一条命令&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PROMPT_COMMAND&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'\
if [ -z &quot;$OLD_PWD&quot; ];then
    export OLD_PWD=$PWD;
    fi;
    if [ ! -z &quot;$LAST_CMD&quot; ] &amp;amp;&amp;amp; [ &quot;$(history 1)&quot; != &quot;$LAST_CMD&quot; ]; then
        logger -t `whoami`_shell_cmd &quot;[$OLD_PWD]$(history 1)&quot;;
        fi ;
        export LAST_CMD=&quot;$(history 1)&quot;;
        export OLD_PWD=$PWD;'&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@master ~]# &lt;span class=&quot;nb&quot;&gt;history&lt;/span&gt;
.....
1054  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;2017-08-08 21:00:11] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;172.16.151.1] &lt;span class=&quot;nb&quot;&gt;history
&lt;/span&gt;1055  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;2017-08-08 21:00:32] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;172.16.151.1] &lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;1056  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;2017-08-08 21:00:36] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;172.16.151.1] &lt;span class=&quot;nb&quot;&gt;history&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;转载请注明出处，本文采用 &lt;a href=&quot;http://creativecommons.org/licenses/by-nc-nd/4.0/&quot;&gt;CC4.0&lt;/a&gt; 协议授权&lt;/p&gt;</content><author><name>Jevic</name></author><summary type="html">默认的history 信息只能看到执行命令而无法得知登陆来源ip以及命令执行时间, 进而为了更加明了的查看主机的操作信息以及操作”证据”的获取，对所有服务器history 显示信息进行了自定义设置…</summary></entry><entry><title type="html">Jstorm 多任务管理脚本</title><link href="http://jevic.cn/2017/08/03/linux-jstorm-job-shell/" rel="alternate" type="text/html" title="Jstorm 多任务管理脚本" /><published>2017-08-03T15:39:53+08:00</published><updated>2017-08-03T15:39:53+08:00</updated><id>http://jevic.cn/2017/08/03/linux-jstorm-job-shell</id><content type="html" xml:base="http://jevic.cn/2017/08/03/linux-jstorm-job-shell/">&lt;blockquote&gt;
  &lt;p&gt;由于之前一直都是手动的执行命令去提交任务和启动停止任务,但是由于计算任务的逐个增加，每次都要敲一大串的命令或者去执行单个任务脚本是一件很痛苦的事情……
为了方便对jstorm任务日常管理操作，将同一业务下的多个任务进行整理写入一个脚本来进行统一操作&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## Jstorm 多任务管理脚本&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;##&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;USAGE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Usage: &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;basename &lt;span class=&quot;nv&quot;&gt;$0&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; [-hms] [SRV] [TYPE] [ACTION] 

SRV (SRV Option) is one of:

    web         &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; web
    app         &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; app
    all              &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; web and app

Where [TYPE] is on of:
    flow        &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; flow
    status      &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; status
    all         &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; all

Where [ACTION] is on of:
    start          &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; start job
    stop          &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; stop  job

-h    &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; display this help.
-d    &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; date   e.g: YYYYmmdd
-t    &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; times  e.g: HHMM&quot;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;## color&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;red&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[31m&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;green&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[32m&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;yellow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[33m&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;plan&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;33[0m&quot;&lt;/span&gt;


&lt;span class=&quot;c&quot;&gt;## webFlow&lt;/span&gt;
webFlow&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$KEY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then

      else

      fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

appFlow&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$KEY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then

      else

      fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

webStatus&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$KEY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then

     elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$KEY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
        
     fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

appStatus&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$KEY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
     &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$KEY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 1 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
     &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

RUN&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$APP&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;web&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
           if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;flow&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
              &lt;/span&gt;webFlow
           &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;status&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
              &lt;/span&gt;webStatus
           &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;all&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
              &lt;/span&gt;webFlow
              webStatus
           &lt;span class=&quot;k&quot;&gt;fi
        elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$APP&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;app&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
           if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;flow&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
              &lt;/span&gt;appFlow
           &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;status&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
              &lt;/span&gt;appStatus
           &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;all&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
              &lt;/span&gt;appFlow
              appStatus
           &lt;span class=&quot;k&quot;&gt;fi
        elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$APP&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;all&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
           if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;flow&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
              &lt;/span&gt;webFlow
              appFlow
           &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;status&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
              &lt;/span&gt;webStatus
              appStatus
           &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;all&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;then
              &lt;/span&gt;webFlow
              appFlow
              webStatus
              appStatus
           &lt;span class=&quot;k&quot;&gt;fi
        fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

main&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;  
&lt;span class=&quot;k&quot;&gt;while &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;getopts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;hm:t:&quot;&lt;/span&gt; opt
&lt;span class=&quot;k&quot;&gt;do
    case&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$opt&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in
       &lt;/span&gt;h&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;USAGE&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;0
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
       m&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$OPTARG&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
       t&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
         &lt;span class=&quot;nv&quot;&gt;Time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$OPTARG&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt; 
       &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;USAGE&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;0
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
     &lt;span class=&quot;k&quot;&gt;esac&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;done

&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;shift&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$((${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;OPTIND&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;SRV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SRV&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in
     &lt;/span&gt;web&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;APP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;web &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
     app&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;APP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;app &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
     all&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;APP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;all &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
     &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;red&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Error: no SRV specified &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$plan&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&amp;amp;2
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;USAGE&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;1
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;esac&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;shift

&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TYPE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$TYPE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in
    &lt;/span&gt;flow&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;nv&quot;&gt;BW&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;flow&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
    status&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;nv&quot;&gt;BW&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;status&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
    all&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;nv&quot;&gt;BW&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;all&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
     &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;red&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Error: no TYPE specified &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$plan&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&amp;amp;2
     &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;1
     &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;esac&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;shift

&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ACTION&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$ACTION&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in 
     &lt;/span&gt;start&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0 
        RUN
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
     stop&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
        RUN
        &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
     &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;USAGE&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
       &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;1
       &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;esac&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

main &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$@&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Jevic</name></author><summary type="html">由于之前一直都是手动的执行命令去提交任务和启动停止任务,但是由于计算任务的逐个增加，每次都要敲一大串的命令或者去执行单个任务脚本是一件很痛苦的事情…… 为了方便对jstorm任务日常管理操作，将同一业务下的多个任务进行整理写入一个脚本来进行统一操作</summary></entry><entry><title type="html">Python Mysql 数据格式化 Json</title><link href="http://jevic.cn/2017/08/02/python-mysql-json/" rel="alternate" type="text/html" title="Python Mysql 数据格式化 Json" /><published>2017-08-02T15:22:52+08:00</published><updated>2017-08-02T15:22:52+08:00</updated><id>http://jevic.cn/2017/08/02/python-mysql-json</id><content type="html" xml:base="http://jevic.cn/2017/08/02/python-mysql-json/">&lt;blockquote&gt;
  &lt;p&gt;获取MySQL的数据并转化为json格式输出&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;mysql.connector&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;json&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'admin'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Host&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'web.mysql.com'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Passwd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Password'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;db&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Passwd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;database&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'website'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cursor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cursor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;cursor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'select * from url_article where stype=&quot;es&quot;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cursor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fetchall&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;JsonData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;SerList&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;SerData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'name'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'url'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'remark'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'stype'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'role'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;SerList&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;SerData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'data'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;SerData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'server'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SerList&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;jsonStr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dumps&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SerData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;jsonStr&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;getstr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JsonData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getstr&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Jevic</name></author><summary type="html">获取MySQL的数据并转化为json格式输出</summary></entry><entry><title type="html">Elasticsearch常用操作(一)</title><link href="http://jevic.cn/2017/07/21/elk-elasticsearch-common-operation/" rel="alternate" type="text/html" title="Elasticsearch常用操作(一)" /><published>2017-07-21T09:26:45+08:00</published><updated>2017-07-21T09:26:45+08:00</updated><id>http://jevic.cn/2017/07/21/elk-elasticsearch-common-operation</id><content type="html" xml:base="http://jevic.cn/2017/07/21/elk-elasticsearch-common-operation/">&lt;h1 id=&quot;sql接口查询&quot;&gt;sql接口查询&lt;/h1&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sql 2.x
curl http://es-node/_sql &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;SELECT count(*) FROM index-test/type where timestamp=1484048580&quot;&lt;/span&gt;

sql 5.x
http://es-node/_sql?sql&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;SELECT count&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; FROM index-test where @timestamp&amp;gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;149925060000 and @timestamp&amp;lt;1499254200000

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;冷热分片&quot;&gt;冷热分片&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl -XPUT $URL/${Inx}-${date}/_settings -d '{ &quot;index.routing.allocation.include.zone&quot;: &quot;hot&quot;}'

curl -XPUT $URL/${Inx}-${date_ops}/_settings -d '{ &quot;index.routing.allocation.include.zone&quot;: &quot;stale&quot;}'

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;索引优化分段&quot;&gt;索引优化分段&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2.x 
curl -XPOST node-es:9200/teset-2017.07.05/_optimize?max_num_segments=1&amp;amp;wait_for_merge=false

5.x
curl -XPOST node-es:9200/test-2017.07.05/_forcemerge?max_num_segments=1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h1 id=&quot;搜索&quot;&gt;搜索&lt;/h1&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET index/doc/_search
GET index/doc/_search?pretty
curl node-es:9200/index/doc/_search |python -mjson.tool
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h1 id=&quot;删除&quot;&gt;删除&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/5.5/docs-delete-by-query.html#docs-delete-by-query&quot;&gt;官方API文档&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;推荐使用: curl -XPOST _delete_by_query?scroll_size=2000&amp;amp;wait_for_completion=false

curl -XPOST node-es:9200/test-index/_delete_by_query -d '
{
  &quot;query&quot;: { 
    &quot;match&quot;: {
      &quot;message&quot;: &quot;some message&quot;
    }
  }
}'

2.x 
curl -XDELETE node-es:9200/test-index/_query -d '{
&quot;query&quot;: { 
    &quot;match&quot;: {
      &quot;message&quot;: &quot;some message&quot;
    }
  }
}'

查询删除任务:
5.x
GET _tasks?detailed=true&amp;amp;actions=*/delete/byquery
2.x
GET _tasks?detailed=true&amp;amp;actions=*/delete/by_query
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;任务查询-_tasks&quot;&gt;任务查询 _tasks&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/tasks.html&quot;&gt;官网API文档&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;es 2.x&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /tasks
GET _cluster/pending_tasks
GET /_tasks?actions=*/list*
GET /_tasks?actions=*reindex,*by_query
返回的结果:
{
.....
      &quot;tasks&quot;: {
        &quot;w8S8uYR9ThelFe7u5blX-Q:466799605&quot;: {
          &quot;node&quot;: &quot;w8S8uYR9ThelFe7u5blX-Q&quot;,
          &quot;id&quot;: 466799605,
          &quot;type&quot;: &quot;transport&quot;,
          &quot;action&quot;: &quot;indices:data/write/delete/by_query&quot;,
          &quot;start_time_in_millis&quot;: 1499846410168,
          &quot;running_time_in_nanos&quot;: 527881720186
.....
}


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;es 5.x&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET _cat/tasks?v&amp;amp;time
GET _tasks?detailed=true&amp;amp;actions=*/delete/byquery
GET _tasks?pretty&amp;amp;detailed&amp;amp;actions=*reindex,*byquery
返回结果:
{
.....
      &quot;tasks&quot;: {
        &quot;RiuComp3TOWhz0y804Ym7A:55597577&quot;: {
          &quot;node&quot;: &quot;RiuComp3TOWhz0y804Ym7A&quot;,
          &quot;id&quot;: 55597577,
          &quot;type&quot;: &quot;transport&quot;,
          &quot;action&quot;: &quot;indices:data/write/delete/byquery&quot;,
          &quot;status&quot;: {
            &quot;total&quot;: 47683364,
            &quot;updated&quot;: 0,
            &quot;created&quot;: 0,
            &quot;deleted&quot;: 15294000,
            &quot;batches&quot;: 7648,
            &quot;version_conflicts&quot;: 0,
            &quot;noops&quot;: 0,
            .....
      }
    }
  }
}

取消任务:
POST _tasks/RiuComp3TOWhz0y804Ym7A:55597577/_cancel


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;添加模板&quot;&gt;添加模板&lt;/h1&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PUT  /_template/test
{
  
  &quot;template&quot;:&quot;test-*&quot;,
  &quot;settings&quot; : {
    &quot;index.refresh_interval&quot; : &quot;60s&quot;
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h1 id=&quot;查询模板&quot;&gt;查询模板&lt;/h1&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET _template/yflive

curl es-3:9200/bank/_count?pretty -d '
{ 
&quot;query&quot;: {
   &quot;match&quot; : { &quot;city&quot; : &quot;SZ&quot; }
}
}'

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;调整查询窗口大小&quot;&gt;调整查询窗口大小&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;get index-test/_settings

PUT index-test/_settings
{ 
  &quot;index&quot; : { 
    &quot;max_result_window&quot; : 500000 
  } 
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;磁盘配额&quot;&gt;磁盘配额&lt;/h1&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PUT _cluster/settings
{
    &quot;transient&quot; : {
        &quot;cluster.routing.allocation.disk.watermark.low&quot; : &quot;90%&quot;,
        &quot;cluster.routing.allocation.disk.watermark.high&quot; : &quot;10gb&quot;
    }
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;更新文档数据&quot;&gt;更新文档数据&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST nginx-log/logs/AVxiwZcu_Z9aU351KXOL/_update
{
  &quot;doc&quot;: {
    &quot;value&quot; : 732439
  }
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;指定索引分片分配到某个特定主机&quot;&gt;指定索引分片分配到某个特定主机&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/shard-allocation-filtering.html&quot;&gt;官网文档&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PUT test/_settings
{
  &quot;index.routing.allocation.include._ip&quot;: &quot;192.168.2.*&quot;
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html&quot;&gt;Index Modules&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;转载请注明出处，本文采用 &lt;a href=&quot;http://creativecommons.org/licenses/by-nc-nd/4.0/&quot;&gt;CC4.0&lt;/a&gt; 协议授权&lt;/p&gt;</content><author><name>Jevic</name></author><summary type="html">sql接口查询</summary></entry></feed>