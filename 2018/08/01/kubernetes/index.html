<!DOCTYPE html>
<html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init">
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.mritd.me/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//piwik.mritd.me/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>kubernetes æ ¸å¿ƒæ¦‚å¿µç®€è¿° &mdash; Jevic</title>
    <link rel="stylesheet" href="/assets/vendor/primer-css/css/primer.css">
    <link rel="stylesheet" href="/assets/vendor/primer-markdown/dist/user-content.min.css">
    <link rel="stylesheet" href="/assets/vendor/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="/assets/css/components/collection.css">
    <link rel="stylesheet" href="/assets/css/components/repo-card.css">
    <link rel="stylesheet" href="/assets/css/sections/repo-list.css">
    <link rel="stylesheet" href="/assets/css/sections/mini-repo-list.css">
    <link rel="stylesheet" href="/assets/css/components/boxed-group.css">
    <link rel="stylesheet" href="/assets/css/globals/common.css">
    <link rel="stylesheet" href="/assets/vendor/share.js/dist/css/share.min.css">
    <link rel="stylesheet" href="/assets/css/globals/responsive.css">
    <link rel="stylesheet" href="/assets/css/posts/index.css">
    <!-- Latest compiled and minified CSS -->
    

    
    <link rel="canonical" href="http://0.0.0.0:80/2018/08/01/kubernetes/">
    <link rel="alternate" type="application/atom+xml" title="Jevic" href="/feed.xml">
    <link rel="shortcut icon" href="/favicon.ico">
    
    <meta property="og:title" content="kubernetes æ ¸å¿ƒæ¦‚å¿µç®€è¿°">
      
    <meta name="keywords" content="docker,kubernetes">
    <meta name="og:keywords" content="docker,kubernetes">
      
    <meta name="description" content="  Kubernetesä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼š">
    <meta name="og:description" content="  Kubernetesä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼š">
      
    
    
        
    
    <meta property="og:url" content="http://0.0.0.0:80/2018/08/01/kubernetes/">
    <meta property="og:site_name" content="Jevic">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh_CN" />
    
    <meta property="article:published_time" content="2018-08-01">
    
    <script src="/assets/vendor/jquery/dist/jquery.min.js"></script>
    <script src="/assets/js/jquery-ui.js"></script>
    <script type="text/javascript">
    function toggleMenu() {
        var nav = document.getElementsByClassName("site-header-nav")[0];
        if (nav.style.display == "inline-flex") {
          nav.style.display = "none";
        } else {
          nav.style.display = "inline-flex";
        }
    }
    </script>
</head>
<body class="" data-mz="">
    <header class="site-header">
        <div class="container">
            <h1><a href="/" title="Jevic"><span class="octicon octicon-mark-github"></span> Jevic</a></h1>
            <button class="collapsed mobile-visible" type="button" onclick="toggleMenu();">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <nav class="site-header-nav" role="navigation">
                
                <a href="/" class=" site-header-nav-item" target="" title="é¦–é¡µ">é¦–é¡µ</a>
                
                <a href="/categories/" class=" site-header-nav-item" target="" title="åˆ†ç±»">åˆ†ç±»</a>
                
                <a href="/wiki/" class=" site-header-nav-item" target="" title="ç»´åŸº">ç»´åŸº</a>
                
                <a href="/open-source/" class=" site-header-nav-item" target="" title="å¼€æº">å¼€æº</a>
                
                <a href="/links/" class=" site-header-nav-item" target="" title="é“¾æ¥">é“¾æ¥</a>
                
                <a href="/about/" class=" site-header-nav-item" target="" title="å…³äº">å…³äº</a>
                
            </nav>
        </div>
    </header>
    <!-- / header -->

    <section class="collection-head small geopattern" data-pattern-id="kubernetes æ ¸å¿ƒæ¦‚å¿µ">
<div class="container">
  <div class="columns">
    <div class="column three-fourths">
      <div class="collection-title">
        <h1 class="collection-header">kubernetes æ ¸å¿ƒæ¦‚å¿µç®€è¿°</h1>
        <div class="collection-info">
          
          <span class="meta-info">
            <span class="octicon octicon-calendar"></span> 2018/08/01
          </span>
          
          
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href="/categories/#Docker" title="Docker">Docker</a>
          </span>
          
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href="/categories/#Kubernetes" title="Kubernetes">Kubernetes</a>
          </span>
          
        </div>
      </div>
    </div>
  </div>
</div>
</section>
<!-- / .banner -->
<section class="container content">
<div class="columns">
  <div class="column three-fourths" >
    <article class="article-content markdown-body">
    <blockquote>
  <p>Kubernetesä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼š</p>
</blockquote>

<ul>
  <li>etcdä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼›</li>
  <li>apiserveræä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ï¼›</li>
  <li>controller managerè´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ï¼›</li>
  <li>schedulerè´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Šï¼›</li>
  <li>kubeletè´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£Volumeï¼ˆCVIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†ï¼›</li>
  <li>Container runtimeè´Ÿè´£é•œåƒç®¡ç†ä»¥åŠPodå’Œå®¹å™¨çš„çœŸæ­£è¿è¡Œï¼ˆCRIï¼‰ï¼›</li>
  <li>kube-proxyè´Ÿè´£ä¸ºServiceæä¾›clusterå†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼›</li>
</ul>

<p><img src="https://raw.githubusercontent.com/jevic/images/master/kubernetes/architecture.png" alt="" /></p>
<h3 id="master">Master</h3>
<p>MasterèŠ‚ç‚¹ä¸Šé¢ä¸»è¦ç”±å››ä¸ªæ¨¡å—ç»„æˆï¼š<code class="highlighter-rouge">APIServer</code>ã€<code class="highlighter-rouge">scheduler</code>ã€<code class="highlighter-rouge">controller manager</code>ã€<code class="highlighter-rouge">etcd</code>ã€‚</p>

<p><code class="highlighter-rouge">APIServer</code>ã€‚APIServerè´Ÿè´£å¯¹å¤–æä¾›RESTfulçš„Kubernetes APIæœåŠ¡ï¼Œå®ƒæ˜¯ç³»ç»Ÿç®¡ç†æŒ‡ä»¤çš„ç»Ÿä¸€å…¥å£ï¼Œä»»ä½•å¯¹èµ„æºè¿›è¡Œå¢åˆ æ”¹æŸ¥çš„æ“ä½œéƒ½è¦äº¤ç»™APIServerå¤„ç†åå†æäº¤ç»™etcdã€‚å¦‚æ¶æ„å›¾ä¸­æ‰€ç¤ºï¼Œkubectlï¼ˆKubernetesæä¾›çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œè¯¥å·¥å…·å†…éƒ¨å°±æ˜¯å¯¹Kubernetes APIçš„è°ƒç”¨ï¼‰æ˜¯ç›´æ¥å’ŒAPIServeräº¤äº’çš„ã€‚</p>

<p><code class="highlighter-rouge">schedule</code>ã€‚schedulerçš„èŒè´£å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯è´Ÿè´£è°ƒåº¦podåˆ°åˆé€‚çš„Nodeä¸Šã€‚å¦‚æœæŠŠschedulerçœ‹æˆä¸€ä¸ªé»‘åŒ£å­ï¼Œé‚£ä¹ˆå®ƒçš„è¾“å…¥æ˜¯podå’Œç”±å¤šä¸ªNodeç»„æˆçš„åˆ—è¡¨ï¼Œè¾“å‡ºæ˜¯Podå’Œä¸€ä¸ªNodeçš„ç»‘å®šï¼Œå³å°†è¿™ä¸ªpodéƒ¨ç½²åˆ°è¿™ä¸ªNodeä¸Šã€‚Kubernetesç›®å‰æä¾›äº†è°ƒåº¦ç®—æ³•ï¼Œä½†æ˜¯åŒæ ·ä¹Ÿä¿ç•™äº†æ¥å£ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®šä¹‰è‡ªå·±çš„è°ƒåº¦ç®—æ³•ã€‚</p>

<p><code class="highlighter-rouge">controller manager</code>ã€‚å¦‚æœè¯´APIServeråšçš„æ˜¯â€œå‰å°â€çš„å·¥ä½œçš„è¯ï¼Œé‚£controller managerå°±æ˜¯è´Ÿè´£â€œåå°â€çš„ã€‚æ¯ä¸ªèµ„æºä¸€èˆ¬éƒ½å¯¹åº”æœ‰ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œè€Œcontroller managerå°±æ˜¯è´Ÿè´£ç®¡ç†è¿™äº›æ§åˆ¶å™¨çš„ã€‚æ¯”å¦‚æˆ‘ä»¬é€šè¿‡APIServeråˆ›å»ºä¸€ä¸ªpodï¼Œå½“è¿™ä¸ªpodåˆ›å»ºæˆåŠŸåï¼ŒAPIServerçš„ä»»åŠ¡å°±ç®—å®Œæˆäº†ã€‚è€Œåé¢ä¿è¯Podçš„çŠ¶æ€å§‹ç»ˆå’Œæˆ‘ä»¬é¢„æœŸçš„ä¸€æ ·çš„é‡ä»»å°±ç”±controller managerå»ä¿è¯äº†ã€‚</p>

<p><code class="highlighter-rouge">etcd</code>ã€‚etcdæ˜¯ä¸€ä¸ªé«˜å¯ç”¨çš„é”®å€¼å­˜å‚¨ç³»ç»Ÿï¼ŒKubernetesä½¿ç”¨å®ƒæ¥å­˜å‚¨å„ä¸ªèµ„æºçš„çŠ¶æ€ï¼Œä»è€Œå®ç°äº†Restfulçš„APIã€‚</p>

<h3 id="node">Node</h3>
<p>æ¯ä¸ªNodeèŠ‚ç‚¹ä¸»è¦ç”±ä¸‰ä¸ªæ¨¡å—ç»„æˆï¼š<code class="highlighter-rouge">kubelet</code>ã€<code class="highlighter-rouge">kube-proxy</code>ã€<code class="highlighter-rouge">runtime</code>ã€‚</p>

<p><code class="highlighter-rouge">runtime</code>ã€‚runtimeæŒ‡çš„æ˜¯å®¹å™¨è¿è¡Œç¯å¢ƒï¼Œç›®å‰Kubernetesæ”¯æŒdockerå’Œrktä¸¤ç§å®¹å™¨ã€‚</p>

<p><code class="highlighter-rouge">kube-proxy</code>ã€‚è¯¥æ¨¡å—å®ç°äº†Kubernetesä¸­çš„æœåŠ¡å‘ç°å’Œåå‘ä»£ç†åŠŸèƒ½ã€‚åå‘ä»£ç†æ–¹é¢ï¼škube-proxyæ”¯æŒTCPå’ŒUDPè¿æ¥è½¬å‘ï¼Œé»˜è®¤åŸºäºRound Robinç®—æ³•å°†å®¢æˆ·ç«¯æµé‡è½¬å‘åˆ°ä¸serviceå¯¹åº”çš„ä¸€ç»„åç«¯podã€‚æœåŠ¡å‘ç°æ–¹é¢ï¼Œkube-proxyä½¿ç”¨etcdçš„watchæœºåˆ¶ï¼Œç›‘æ§é›†ç¾¤ä¸­serviceå’Œendpointå¯¹è±¡æ•°æ®çš„åŠ¨æ€å˜åŒ–ï¼Œå¹¶ä¸”ç»´æŠ¤ä¸€ä¸ªserviceåˆ°endpointçš„æ˜ å°„å…³ç³»ï¼Œä»è€Œä¿è¯äº†åç«¯podçš„IPå˜åŒ–ä¸ä¼šå¯¹è®¿é—®è€…é€ æˆå½±å“ã€‚å¦å¤–kube-proxyè¿˜æ”¯æŒsession affinityã€‚</p>

<p><code class="highlighter-rouge">kubelet</code>ã€‚Kubeletæ˜¯Masteråœ¨æ¯ä¸ªNodeèŠ‚ç‚¹ä¸Šé¢çš„agentï¼Œæ˜¯NodeèŠ‚ç‚¹ä¸Šé¢æœ€é‡è¦çš„æ¨¡å—ï¼Œå®ƒè´Ÿè´£ç»´æŠ¤å’Œç®¡ç†è¯¥Nodeä¸Šé¢çš„æ‰€æœ‰å®¹å™¨ï¼Œä½†æ˜¯å¦‚æœå®¹å™¨ä¸æ˜¯é€šè¿‡Kubernetesåˆ›å»ºçš„ï¼Œå®ƒå¹¶ä¸ä¼šç®¡ç†ã€‚æœ¬è´¨ä¸Šï¼Œå®ƒè´Ÿè´£ä½¿Podå¾—è¿è¡ŒçŠ¶æ€ä¸æœŸæœ›çš„çŠ¶æ€ä¸€è‡´ã€‚</p>

<p>è‡³æ­¤ï¼ŒKubernetesçš„Masterå’ŒNodeå°±ç®€å•ä»‹ç»å®Œäº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹Kubernetesä¸­çš„å„ç§èµ„æº/å¯¹è±¡ã€‚</p>

<h2 id="label">label</h2>

<p>æ·»åŠ </p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl label nodes master219 myapp=flask-app
</code></pre></div></div>

<p>åˆ é™¤</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl label nodes master219 myapp-
</code></pre></div></div>

<blockquote>
  <p>è®¸å¤šèµ„æºæ”¯æŒå†…åµŒå­—æ®µå®šä¹‰å…¶ä½¿ç”¨çš„æ ‡ç­¾é€‰æ‹©å™¨:</p>
</blockquote>

<ul>
  <li>matchLabels:ç›´æ¥ç»™å®šé”®å€¼</li>
  <li>matchExpressions:åŸºäºç»™å®šçš„è¡¨è¾¾å¼æ¥å®šä¹‰ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨
    <ul>
      <li>{key:â€KEYâ€, operator:â€OPERATORâ€,</li>
    </ul>
  </li>
  <li>values:[VAL1,VAL2,â€¦]} æ“ä½œç¬¦:
    <ul>
      <li>In, NotIn:  valueså­—æ®µçš„å€¼å¿…é¡»ä¸ºéç©ºåˆ—è¡¨;</li>
      <li>Exists, NotExists:  valueså­—æ®µçš„å€¼å¿…é¡»ä¸ºç©ºåˆ—è¡¨</li>
    </ul>
  </li>
</ul>

<h2 id="pod">Pod</h2>
<h3 id="pod-é…ç½®é¡¹">Pod é…ç½®é¡¹</h3>
<p>é•œåƒ:
Alwaysï¼šæ¯æ¬¡éƒ½ä¸‹è½½æœ€æ–°çš„é•œåƒ
Neverï¼šåªä½¿ç”¨æœ¬åœ°é•œåƒï¼Œä»ä¸ä¸‹è½½
IfNotPresentï¼šåªæœ‰å½“æœ¬åœ°æ²¡æœ‰çš„æ—¶å€™æ‰ä¸‹è½½é•œåƒ</p>

<p>Hostç½‘ç»œ: 
ä¸€äº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œå®¹å™¨å¿…é¡»è¦ä»¥hostæ–¹å¼è¿›è¡Œç½‘ç»œè®¾ç½®ï¼ˆå¦‚æ¥æ”¶ç‰©ç†æœºç½‘ç»œæ‰èƒ½å¤Ÿæ¥æ”¶åˆ°çš„ç»„æ’­æµï¼‰ï¼Œåœ¨Podä¸­ä¹Ÿæ”¯æŒhostç½‘ç»œçš„è®¾ç½®ï¼Œå¦‚ï¼škubectl explain Pod.spec.hostNetworkï¼›</p>

<p>affinity: è°ƒåº¦å™¨; kubectl explain Pod.spec.affinity</p>

<h2 id="controllers">Controllers</h2>
<p>å…³äºpod ç›®å‰æ‰€æ”¯æŒçš„æ§åˆ¶å™¨è¯·æŸ¥çœ‹<a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/">å®˜ç½‘æ–‡æ¡£</a></p>

<h3 id="replicationcontroller">ReplicationController:</h3>

<p>Replication Controllerï¼ˆRCï¼‰æ˜¯Kubernetesä¸­çš„å¦ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œåº”ç”¨æ‰˜ç®¡åœ¨Kubernetesä¹‹åï¼ŒKuberneteséœ€è¦ä¿è¯åº”ç”¨èƒ½å¤ŸæŒç»­è¿è¡Œï¼Œè¿™æ˜¯RCçš„å·¥ä½œå†…å®¹ï¼Œå®ƒä¼šç¡®ä¿ä»»ä½•æ—¶é—´Kubernetesä¸­éƒ½æœ‰æŒ‡å®šæ•°é‡çš„Podåœ¨è¿è¡Œã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒRCè¿˜æä¾›äº†ä¸€äº›æ›´é«˜çº§çš„ç‰¹æ€§ï¼Œæ¯”å¦‚æ»šåŠ¨å‡çº§ã€å‡çº§å›æ»šç­‰ã€‚</p>

<h3 id="replicaset">ReplicaSet:</h3>

<p>è¿™é‡Œæ‰€è¯´çš„replica setï¼Œå¯ä»¥è¢«è®¤ä¸º æ˜¯â€œå‡çº§ç‰ˆâ€çš„Replication Controllerã€‚ä¹Ÿå°±æ˜¯è¯´ã€‚replica setä¹Ÿæ˜¯ç”¨äºä¿è¯ä¸label selectoråŒ¹é…çš„podæ•°é‡ç»´æŒåœ¨æœŸæœ›çŠ¶æ€ã€‚åŒºåˆ«åœ¨äºï¼Œreplica setå¼•å…¥äº†å¯¹åŸºäºå­é›†çš„selectoræŸ¥è¯¢æ¡ä»¶ï¼Œè€ŒReplication Controllerä»…æ”¯æŒåŸºäºå€¼ç›¸ç­‰çš„selectoæ¡ä»¶æŸ¥è¯¢ã€‚è¿™æ˜¯ç›®å‰ä»ç”¨æˆ·è§’åº¦è‚´ï¼Œä¸¤è€…å”¯ä¸€çš„æ˜¾è‘—å·®å¼‚ã€‚ ç¤¾åŒºå¼•å…¥è¿™ä¸€APIçš„åˆè¡·æ˜¯ç”¨äºå–ä»£vlä¸­çš„Replication Controllerï¼Œä¹Ÿå°±æ˜¯è¯´ï¼å½“v1ç‰ˆæœ¬è¢«åºŸå¼ƒæ—¶ï¼ŒReplication Controllerå°±å®Œæˆäº†å®ƒçš„å†å²ä½¿å‘½ï¼Œè€Œç”±replica setæ¥æ¥ç®¡å…¶å·¥ä½œã€‚è™½ç„¶replica setå¯ä»¥è¢«å•ç‹¬ä½¿ç”¨ï¼Œä½†æ˜¯ç›®å‰å®ƒå¤šè¢«Deploymentç”¨äºè¿›è¡Œpodçš„åˆ›å»ºã€æ›´æ–°ä¸åˆ é™¤ã€‚ã€€</p>

<h3 id="daemonset">DaemonSet</h3>

<p>DaemonSetèƒ½å¤Ÿè®©æ‰€æœ‰ï¼ˆæˆ–è€…ç‰¹å®šï¼‰çš„èŠ‚ç‚¹è¿è¡ŒåŒä¸€ä¸ªpodã€‚</p>

<p>å½“èŠ‚ç‚¹åŠ å…¥åˆ°K8Sé›†ç¾¤ä¸­ï¼Œpodä¼šè¢«ï¼ˆDaemonSetï¼‰è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå½“èŠ‚ç‚¹ä»K8Sé›†ç¾¤ä¸­è¢«ç§»é™¤ï¼Œè¢«DaemonSetè°ƒåº¦çš„podä¼šè¢«ç§»é™¤ï¼Œå¦‚æœåˆ é™¤DaemonSetï¼Œæ‰€æœ‰è·Ÿè¿™ä¸ªDaemonSetç›¸å…³çš„podséƒ½ä¼šè¢«åˆ é™¤ã€‚</p>

<p>åœ¨æŸç§ç¨‹åº¦ä¸Šï¼ŒDaemonSetæ‰¿æ‹…äº†RCçš„éƒ¨åˆ†åŠŸèƒ½ï¼Œå®ƒä¹Ÿèƒ½ä¿è¯ç›¸å…³podsæŒç»­è¿è¡Œï¼Œå¦‚æœä¸€ä¸ªDaemonSetçš„Podè¢«æ€æ­»ã€åœæ­¢ã€æˆ–è€…å´©æºƒï¼Œé‚£ä¹ˆDaemonSetå°†ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„å‰¯æœ¬åœ¨è¿™å°è®¡ç®—èŠ‚ç‚¹ä¸Šã€‚</p>

<p>ä¸€èˆ¬åº”ç”¨äºæ—¥å¿—æ”¶é›†ã€ç›‘æ§é‡‡é›†ã€åˆ†å¸ƒå¼å­˜å‚¨å®ˆæŠ¤è¿›ç¨‹ã€ingressç­‰</p>

<h3 id="job">Job</h3>

<p>ä»ç¨‹åºçš„è¿è¡Œå½¢æ€ä¸Šæ¥åŒºåˆ†ï¼Œæˆ‘ä»¬å¯ä»¥å°†Podåˆ†ä¸ºä¸¤ç±»ï¼šé•¿æ—¶è¿è¡ŒæœåŠ¡ï¼ˆjbossã€mysqlç­‰ï¼‰å’Œä¸€æ¬¡æ€§ä»»åŠ¡ï¼ˆæ•°æ®è®¡ç®—ã€æµ‹è¯•ï¼‰ã€‚RCåˆ›å»ºçš„Podéƒ½æ˜¯é•¿æ—¶è¿è¡Œçš„æœåŠ¡ï¼Œè€ŒJobåˆ›å»ºçš„Podéƒ½æ˜¯ä¸€æ¬¡æ€§ä»»åŠ¡ã€‚
  åœ¨Jobçš„å®šä¹‰ä¸­ï¼ŒrestartPolicyï¼ˆé‡å¯ç­–ç•¥ï¼‰åªèƒ½æ˜¯Neverå’ŒOnFailureã€‚Jobå¯ä»¥æ§åˆ¶ä¸€æ¬¡æ€§ä»»åŠ¡çš„Podçš„å®Œæˆæ¬¡æ•°ï¼ˆJobâ€“&gt;specâ€“&gt;completionsï¼‰å’Œå¹¶å‘æ‰§è¡Œæ•°ï¼ˆJobâ€“&gt;specâ€“&gt;parallelismï¼‰ï¼Œå½“PodæˆåŠŸæ‰§è¡ŒæŒ‡å®šæ¬¡æ•°åï¼Œå³è®¤ä¸ºJobæ‰§è¡Œå®Œæ¯•ã€‚
ã€€ã€€</p>
<h3 id="cronjob">Cronjob</h3>

<p>Kubernetesé›†ç¾¤ä½¿ç”¨Cron Jobç®¡ç†åŸºäºæ—¶é—´çš„ä½œä¸šï¼Œå¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´ç‚¹æ‰§è¡Œä¸€æ¬¡æˆ–åœ¨æŒ‡å®šæ—¶é—´ç‚¹æ‰§è¡Œå¤šæ¬¡ä»»åŠ¡ã€‚ ä¸€ä¸ªCron Jobå°±å¥½åƒLinux crontabä¸­çš„ä¸€è¡Œï¼Œå¯ä»¥æŒ‰ç…§Cronå®šæ—¶è¿è¡Œä»»åŠ¡</p>

<h3 id="statefulset">StatefulSet</h3>

<p>K8såœ¨1.3ç‰ˆæœ¬é‡Œå‘å¸ƒäº†Alphaç‰ˆçš„PetSetåŠŸèƒ½ã€‚åœ¨äº‘åŸç”Ÿåº”ç”¨çš„ä½“ç³»é‡Œï¼Œæœ‰ä¸‹é¢ä¸¤ç»„è¿‘ä¹‰è¯ï¼›ç¬¬ä¸€ç»„æ˜¯æ— çŠ¶æ€ï¼ˆstatelessï¼‰ã€ç‰²ç•œï¼ˆcattleï¼‰ã€æ— åï¼ˆnamelessï¼‰ã€å¯ä¸¢å¼ƒï¼ˆdisposableï¼‰ï¼›ç¬¬äºŒç»„æ˜¯æœ‰çŠ¶æ€ï¼ˆstatefulï¼‰ã€å® ç‰©ï¼ˆpetï¼‰ã€æœ‰åï¼ˆhaving nameï¼‰ã€ä¸å¯ä¸¢å¼ƒï¼ˆnon-disposableï¼‰ã€‚RCå’ŒRSä¸»è¦æ˜¯æ§åˆ¶æä¾›æ— çŠ¶æ€æœåŠ¡çš„ï¼Œå…¶æ‰€æ§åˆ¶çš„Podçš„åå­—æ˜¯éšæœºè®¾ç½®çš„ï¼Œä¸€ä¸ªPodå‡ºæ•…éšœäº†å°±è¢«ä¸¢å¼ƒæ‰ï¼Œåœ¨å¦ä¸€ä¸ªåœ°æ–¹é‡å¯ä¸€ä¸ªæ–°çš„Podï¼Œåå­—å˜äº†ã€åå­—å’Œå¯åŠ¨åœ¨å“ªå„¿éƒ½ä¸é‡è¦ï¼Œé‡è¦çš„åªæ˜¯Podæ€»æ•°ï¼›è€ŒPetSetæ˜¯ç”¨æ¥æ§åˆ¶æœ‰çŠ¶æ€æœåŠ¡ï¼ŒPetSetä¸­çš„æ¯ä¸ªPodçš„åå­—éƒ½æ˜¯äº‹å…ˆç¡®å®šçš„ï¼Œä¸èƒ½æ›´æ”¹ã€‚PetSetä¸­Podçš„åå­—çš„ä½œç”¨ï¼Œæ˜¯ç”¨æ¥å…³è”ä¸è¯¥Podå¯¹åº”çš„çŠ¶æ€ã€‚</p>

<p>ã€€ã€€å¯¹äºRCå’ŒRSä¸­çš„Podï¼Œä¸€èˆ¬ä¸æŒ‚è½½å­˜å‚¨æˆ–è€…æŒ‚è½½å…±äº«å­˜å‚¨ï¼Œä¿å­˜çš„æ˜¯æ‰€æœ‰Podå…±äº«çš„çŠ¶æ€ï¼ŒPodåƒç‰²ç•œä¸€æ ·æ²¡æœ‰åˆ†åˆ«ï¼›å¯¹äºPetSetä¸­çš„Podï¼Œæ¯ä¸ªPodæŒ‚è½½è‡ªå·±ç‹¬ç«‹çš„å­˜å‚¨ï¼Œå¦‚æœä¸€ä¸ªPodå‡ºç°æ•…éšœï¼Œä»å…¶ä»–èŠ‚ç‚¹å¯åŠ¨ä¸€ä¸ªåŒæ ·åå­—çš„Podï¼Œè¦æŒ‚åœ¨ä¸ŠåŸæ¥Podçš„å­˜å‚¨ç»§ç»­ä»¥å®ƒçš„çŠ¶æ€æä¾›æœåŠ¡ã€‚</p>

<p>ã€€ã€€é€‚åˆäºPetSetçš„ä¸šåŠ¡åŒ…æ‹¬æ•°æ®åº“æœåŠ¡MySQLå’ŒPostgreSQLï¼Œé›†ç¾¤åŒ–ç®¡ç†æœåŠ¡Zookeeperã€etcdç­‰æœ‰çŠ¶æ€æœåŠ¡ã€‚PetSetçš„å¦ä¸€ç§å…¸å‹åº”ç”¨åœºæ™¯æ˜¯ä½œä¸ºä¸€ç§æ¯”æ™®é€šå®¹å™¨æ›´ç¨³å®šå¯é çš„æ¨¡æ‹Ÿè™šæ‹Ÿæœºçš„æœºåˆ¶ã€‚ä¼ ç»Ÿçš„è™šæ‹Ÿæœºæ­£æ˜¯ä¸€ç§æœ‰çŠ¶æ€çš„å® ç‰©ï¼Œè¿ç»´äººå‘˜éœ€è¦ä¸æ–­åœ°ç»´æŠ¤å®ƒï¼Œå®¹å™¨åˆšå¼€å§‹æµè¡Œæ—¶ï¼Œæˆ‘ä»¬ç”¨å®¹å™¨æ¥æ¨¡æ‹Ÿè™šæ‹Ÿæœºä½¿ç”¨ï¼Œæ‰€æœ‰çŠ¶æ€éƒ½ä¿å­˜åœ¨å®¹å™¨é‡Œï¼Œè€Œè¿™å·²è¢«è¯æ˜æ˜¯éå¸¸ä¸å®‰å…¨ã€ä¸å¯é çš„ã€‚ä½¿ç”¨PetSetï¼ŒPodä»ç„¶å¯ä»¥é€šè¿‡æ¼‚ç§»åˆ°ä¸åŒèŠ‚ç‚¹æä¾›é«˜å¯ç”¨ï¼Œè€Œå­˜å‚¨ä¹Ÿå¯ä»¥é€šè¿‡å¤–æŒ‚çš„å­˜å‚¨æ¥æä¾›é«˜å¯é æ€§ï¼ŒPetSetåšçš„åªæ˜¯å°†ç¡®å®šçš„Podä¸ç¡®å®šçš„å­˜å‚¨å…³è”èµ·æ¥ä¿è¯çŠ¶æ€çš„è¿ç»­æ€§ã€‚</p>

<h3 id="deployment">Deployment</h3>
<ul>
  <li>åŸºäºæ­¤å¼ºå¤§ç‰¹æ€§åœ¨éƒ¨ç½²æœåŠ¡è½»æ¾æ‰§è¡Œ<a href="https://www.jevic.cn/2018/02/22/devops-deployment/">é‡‘ä¸é›€å‘å¸ƒ</a>ä»¥åŠ<a href="https://www.jevic.cn/2018/02/22/devops-deployment/">è“ç»¿å‘å¸ƒ</a>â€¦..  å¼ºå¤§åˆ°æ²¡æœ‰æœ‹å‹ğŸ‘¬ ğŸ˜„</li>
</ul>

<p>Kubernetesæä¾›äº†ä¸€ç§æ›´åŠ ç®€å•çš„æ›´æ–°RCå’ŒPodçš„æœºåˆ¶ï¼Œå«åšDeploymentã€‚é€šè¿‡åœ¨Deploymentä¸­æè¿°ä½ æ‰€æœŸæœ›çš„é›†ç¾¤çŠ¶æ€ï¼ŒDeployment Controllerä¼šå°†ç°åœ¨çš„é›†ç¾¤çŠ¶æ€åœ¨ä¸€ä¸ªå¯æ§çš„é€Ÿåº¦ä¸‹é€æ­¥æ›´æ–°æˆä½ æ‰€æœŸæœ›çš„é›†ç¾¤çŠ¶æ€ã€‚Deploymentä¸»è¦èŒè´£åŒæ ·æ˜¯ä¸ºäº†ä¿è¯podçš„æ•°é‡å’Œå¥åº·ï¼Œ90%çš„åŠŸèƒ½ä¸Replication Controllerå®Œå…¨ä¸€æ ·ï¼Œå¯ä»¥çœ‹åšæ–°ä¸€ä»£çš„Replication Controllerã€‚ä½†æ˜¯ï¼Œå®ƒåˆå…·å¤‡äº†Replication Controllerä¹‹å¤–çš„æ–°ç‰¹æ€§ï¼š</p>

<p>Deploymentç»§æ‰¿äº†ä¸Šé¢æè¿°çš„Replication Controllerå…¨éƒ¨åŠŸèƒ½ã€‚</p>

<p><code class="highlighter-rouge">äº‹ä»¶å’ŒçŠ¶æ€æŸ¥çœ‹</code>ï¼šå¯ä»¥æŸ¥çœ‹Deploymentçš„å‡çº§è¯¦ç»†è¿›åº¦å’ŒçŠ¶æ€ã€‚</p>

<p><code class="highlighter-rouge">å›æ»š</code>ï¼šå½“å‡çº§podé•œåƒæˆ–è€…ç›¸å…³å‚æ•°çš„æ—¶å€™å‘ç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å›æ»šæ“ä½œå›æ»šåˆ°ä¸Šä¸€ä¸ªç¨³å®šçš„ç‰ˆæœ¬æˆ–è€…æŒ‡å®šçš„ç‰ˆæœ¬ã€‚</p>

<p><code class="highlighter-rouge">ç‰ˆæœ¬è®°å½•</code>: æ¯ä¸€æ¬¡å¯¹Deploymentçš„æ“ä½œï¼Œéƒ½èƒ½ä¿å­˜ä¸‹æ¥ï¼Œç»™äºˆåç»­å¯èƒ½çš„å›æ»šä½¿ç”¨ã€‚</p>

<p><code class="highlighter-rouge">æš‚åœå’Œå¯åŠ¨</code>ï¼šå¯¹äºæ¯ä¸€æ¬¡å‡çº§ï¼Œéƒ½èƒ½å¤Ÿéšæ—¶æš‚åœå’Œå¯åŠ¨ã€‚</p>

<p><code class="highlighter-rouge">å¤šç§å‡çº§æ–¹æ¡ˆ</code>ï¼š
Recreateâ€”-åˆ é™¤æ‰€æœ‰å·²å­˜åœ¨çš„pod,é‡æ–°åˆ›å»ºæ–°çš„; 
RollingUpdateâ€”-æ»šåŠ¨å‡çº§ï¼Œé€æ­¥æ›¿æ¢çš„ç­–ç•¥ï¼ŒåŒæ—¶æ»šåŠ¨å‡çº§æ—¶ï¼Œæ”¯æŒæ›´å¤šçš„é™„åŠ å‚æ•°ï¼Œä¾‹å¦‚è®¾ç½®æœ€å¤§ä¸å¯ç”¨podæ•°é‡ï¼Œæœ€å°å‡çº§é—´éš”æ—¶é—´ç­‰ç­‰ã€‚
ã€€ã€€ã€€</p>

<h4 id="å¼¹æ€§ä¼¸ç¼©">å¼¹æ€§ä¼¸ç¼©</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl scale [--resource-version=version] [--current-replicas=count] --replicas=COUNT (-f FILENAME | TYPE NAME)
</code></pre></div></div>

<p>ç¼©å°å‰¯æœ¬ä¸º1</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl scale --replicas=1 deployment flask-app-deploy  
</code></pre></div></div>

<p>æ‰©å®¹åˆ°5</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl scale --replicas=5 deployment flask-app-deploy  
</code></pre></div></div>

<h4 id="åº”ç”¨å‡çº§">åº”ç”¨å‡çº§</h4>
<blockquote>
  <p>æ›´æ–°é•œåƒ</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. kubectl set image deployment flask-app-deploy flask-app=jevic/app:v2
2. kubectl patch deployment flask-app-deploy -p '{"spec":{"containers":[{"name":"flask-app","image":"jevic/app:v2"}]}}'

æš‚åœ
kubectl rollout pause deployment flask-app-deploy 
å–æ¶ˆæš‚åœ
kubectl pause resume deployment flask-app-deploy
</code></pre></div></div>

<h4 id="å›æ»š">å›æ»š</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># kubectl rollout --help
# kubectl rollout history deployment flask-app-deploy
deployments "flask-app-deploy"
REVISION  CHANGE-CAUSE
1         &lt;none&gt;
2         &lt;none&gt;
3         &lt;none&gt;
# kubectl get rs -o wide -l app=flask-app
NAME                          DESIRED   CURRENT   READY     AGE       CONTAINERS   IMAGES         SELECTOR
flask-app-deploy-5dcb69465c   3         3         3         6m        flask-app    jevic/app:v2   app=flask-app,pod-template-hash=1876250217
flask-app-deploy-6c4896f74b   0         0         0         9m        flask-app    jevic/app:v1   app=flask-app,pod-template-hash=2704529306
flask-app-deploy-9c5bc8bd8    0         0         0         13m       flask-app    jevic/app:v1   app=flask-app,pod-template-hash=571674684

# kubectl rollout undo deployment flask-app-deploy --to-revision=1
# kubectl get rs -o wide -l app=flask-app
NAME                          DESIRED   CURRENT   READY     AGE       CONTAINERS   IMAGES         SELECTOR
flask-app-deploy-5dcb69465c   0         0         0         9m        flask-app    jevic/app:v2   app=flask-app,pod-template-hash=1876250217
flask-app-deploy-6c4896f74b   0         0         0         12m       flask-app    jevic/app:v1   app=flask-app,pod-template-hash=2704529306
flask-app-deploy-9c5bc8bd8    3         3         3         15m       flask-app    jevic/app:v1   app=flask-app,pod-template-hash=571674684
</code></pre></div></div>

<p>â€“to-revision=1 å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬,ä¸æŒ‡å®šé»˜è®¤å›æ»šåˆ°å‰ä¸€ä¸ªç‰ˆæœ¬</p>

<h2 id="services">Services</h2>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service </a></p>

<p>åœ¨Kubernetesä¸­ï¼Œåœ¨å—åˆ°RCè°ƒæ§çš„æ—¶å€™ï¼ŒPodå‰¯æœ¬æ˜¯å˜åŒ–çš„ï¼Œå¯¹äºçš„è™šæ‹ŸIPä¹Ÿæ˜¯å˜åŒ–çš„ï¼Œæ¯”å¦‚å‘ç”Ÿè¿ç§»æˆ–è€…ä¼¸ç¼©çš„æ—¶å€™ã€‚è¿™å¯¹äºPodçš„è®¿é—®è€…æ¥è¯´æ˜¯ä¸å¯æ¥å—çš„ã€‚Kubernetesä¸­çš„Serviceæ˜¯ä¸€ç§æŠ½è±¡æ¦‚å¿µï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªPodé€»è¾‘é›†åˆä»¥åŠè®¿é—®å®ƒä»¬çš„ç­–ç•¥ï¼ŒServiceåŒPodçš„å…³è”åŒæ ·æ˜¯å±…äºLabelæ¥å®Œæˆçš„ã€‚Serviceçš„ç›®æ ‡æ˜¯æä¾›ä¸€ç§æ¡¥æ¢ï¼Œ å®ƒä¼šä¸ºè®¿é—®è€…æä¾›ä¸€ä¸ªå›ºå®šè®¿é—®åœ°å€ï¼Œç”¨äºåœ¨è®¿é—®æ—¶é‡å®šå‘åˆ°ç›¸åº”çš„åç«¯ï¼Œè¿™ä½¿å¾—é KubernetesåŸç”Ÿåº”ç”¨ç¨‹åºï¼Œåœ¨æ— é¡»ä¸ºKubemcesç¼–å†™ç‰¹å®šä»£ç çš„å‰æä¸‹ï¼Œè½»æ¾è®¿é—®åç«¯ã€‚</p>

<p>ServiceåŒRCä¸€æ ·ï¼Œéƒ½æ˜¯é€šè¿‡Labelæ¥å…³è”Podçš„ã€‚å½“ä½ åœ¨Serviceçš„yamlæ–‡ä»¶ä¸­å®šä¹‰äº†è¯¥Serviceçš„selectorä¸­çš„labelä¸ºapp:my-webï¼Œé‚£ä¹ˆè¿™ä¸ªServiceä¼šå°†Podâ€“&gt;metadataâ€“&gt;labeksä¸­labelä¸ºapp:my-webçš„Podä½œä¸ºåˆ†å‘è¯·æ±‚çš„åç«¯ã€‚å½“Podå‘ç”Ÿå˜åŒ–æ—¶ï¼ˆå¢åŠ ã€å‡å°‘ã€é‡å»ºç­‰ï¼‰ï¼ŒServiceä¼šåŠæ—¶æ›´æ–°ã€‚è¿™æ ·ä¸€æ¥ï¼ŒServiceå°±å¯ä»¥ä½œä¸ºPodçš„è®¿é—®å…¥å£ï¼Œèµ·åˆ°ä»£ç†æœåŠ¡å™¨çš„ä½œç”¨ï¼Œè€Œå¯¹äºè®¿é—®è€…æ¥è¯´ï¼Œé€šè¿‡Serviceè¿›è¡Œè®¿é—®ï¼Œæ— éœ€ç›´æ¥æ„ŸçŸ¥Podã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒKubernetesåˆ†é…ç»™Serviceçš„å›ºå®šIPæ˜¯ä¸€ä¸ªè™šæ‹ŸIPï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªçœŸå®çš„IPï¼Œåœ¨å¤–éƒ¨æ˜¯æ— æ³•å¯»å€çš„ã€‚çœŸå®çš„ç³»ç»Ÿå®ç°ä¸Šï¼ŒKubernetesæ˜¯é€šè¿‡<code class="highlighter-rouge">Kube-proxy</code>ç»„ä»¶æ¥å®ç°çš„è™šæ‹ŸIPè·¯ç”±åŠè½¬å‘ã€‚æ‰€ä»¥åœ¨ä¹‹å‰é›†ç¾¤éƒ¨ç½²çš„ç¯èŠ‚ä¸Šï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªNodeä¸Šå‡éƒ¨ç½²äº†Proxyè¿™ä¸ªç»„ä»¶ï¼Œä»è€Œå®ç°äº†Kuberneteså±‚çº§çš„è™šæ‹Ÿè½¬å‘ç½‘ç»œã€‚</p>

<h3 id="å·¥ä½œæ¨¡å¼">å·¥ä½œæ¨¡å¼</h3>
<p>åœ¨kubernetes çš„ç‰ˆæœ¬è¿­ä»£å†å²åˆ°ç›®å‰ä¸ºæ­¢<code class="highlighter-rouge">kube-proxy</code>æœ‰ä¸‰ç§å·¥ä½œæ¨¡å¼:</p>

<ul>
  <li>userspace: 1.1 ç‰ˆæœ¬ä¹‹å‰ä½¿ç”¨</li>
  <li>iptables: 1.10 ç‰ˆæœ¬ä¹‹å‰ä½¿ç”¨</li>
  <li>ipvs: 1.11 ç‰ˆæœ¬ä¹‹åä½¿ç”¨(å¦‚æœipvs ä¸å¯ç”¨è‡ªåŠ¨é™çº§ä½¿ç”¨iptables)
    <ul>
      <li><a href="https://github.com/kubernetes/kubernetes/tree/master/pkg/proxy/ipvs">proxy ipvs</a></li>
      <li>æ³¨æ„: å¯ç”¨å‰éœ€è¦å®‰è£…ä¾èµ–å’Œå¯ç”¨ç›¸å…³å†…æ ¸æ¨¡å—</li>
    </ul>
  </li>
</ul>

<h3 id="ç½‘ç»œæ¨¡å¼">ç½‘ç»œæ¨¡å¼</h3>
<ul>
  <li>ClusterIP  é›†ç¾¤å†…éƒ¨é€šä¿¡</li>
  <li>NodePort
    <ul>
      <li>å¤–éƒ¨å¯è®¿é—®</li>
      <li>Client &gt; NodeIP:NodePort &gt; ClusterIP:svcPort &gt; PodIP:containerPort</li>
    </ul>
  </li>
  <li>LoadBalancer è´Ÿè½½å‡è¡¡å™¨</li>
  <li>ExternelName  FQDN</li>
  <li>None Headless Service
    <ul>
      <li>ServiceName &gt; PodIP:containerPort</li>
    </ul>
  </li>
</ul>

<h3 id="åˆ›å»º-services">åˆ›å»º Services</h3>

<ul>
  <li>ä½¿ç”¨ expose</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># kubectl expose deployment nginx-demo --name=nginx-demo-svc --port=80,443 
service "nginx-demo-svc" exposed
</code></pre></div></div>

<ul>
  <li>å®šä¹‰èµ„æºæ¸…å•åˆ›å»º</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: v1
kind: Service
metadata:
  name: nginx-demo
  labels:
    app: nginx-demo
spec:
  type: NodePort
  ports:
  - port: 80
    protocol: TCP
    name: http
  - port: 443
    protocol: TCP
    name: https
  selector:
    app: nginx-demo
</code></pre></div></div>

<p>æŸ¥çœ‹ services</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># kubectl get svc -l nginx=nginx-demo
NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
nginx-demo       ClusterIP   10.254.20.0     &lt;none&gt;        80/TCP,443/TCP   1d
nginx-demo-svc   ClusterIP   10.254.41.208   &lt;none&gt;        80/TCP,443/TCP   1m
</code></pre></div></div>

<ul>
  <li>è§£ææœåŠ¡</li>
</ul>

<p>èµ„æºè®°å½•: SVC_NAME.NS_NAME.DOMAIN.LTD.</p>

<p>é»˜è®¤ä¸º: svc.cluster.local.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># kubectl get svc -n kube-system
NAME                   TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)         AGE
coredns                ClusterIP   10.254.0.2       &lt;none&gt;        53/UDP,53/TCP   20d
# dig -t A nginx-demo.default.svc.cluster.local @10.254.0.2

; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-29.el7 &lt;&lt;&gt;&gt; -t A nginx-demo.default.svc.cluster.local @10.254.0.2
....
;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;nginx-demo.default.svc.cluster.local. IN A

;; ANSWER SECTION:
nginx-demo.default.svc.cluster.local. 5	IN A	10.254.20.0
....

# dig -t A nginx-demo-svc.default.svc.cluster.local @10.254.0.2

; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-29.el7 &lt;&lt;&gt;&gt; -t A nginx-demo-svc.default.svc.cluster.local @10.254.0.2
....
;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;nginx-demo-svc.default.svc.cluster.local. IN A

;; ANSWER SECTION:
nginx-demo-svc.default.svc.cluster.local. 5 IN A 10.254.41.208
.....
</code></pre></div></div>

<h2 id="configmap">ConfigMap</h2>
<p><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/">configmap</a></p>

<p>å¾ˆå¤šç”Ÿäº§ç¯å¢ƒä¸­çš„åº”ç”¨ç¨‹åºé…ç½®è¾ƒä¸ºå¤æ‚ï¼Œå¯èƒ½éœ€è¦å¤šä¸ªconfigæ–‡ä»¶ã€å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡çš„ç»„åˆã€‚å¹¶ä¸”ï¼Œè¿™äº›é…ç½®ä¿¡æ¯åº”è¯¥ä»åº”ç”¨ç¨‹åºé•œåƒä¸­è§£è€¦å‡ºæ¥ï¼Œä»¥ä¿è¯é•œåƒçš„å¯ç§»æ¤æ€§ä»¥åŠé…ç½®ä¿¡æ¯ä¸è¢«æ³„éœ²ã€‚ç¤¾åŒºå¼•å…¥ConfigMapè¿™ä¸ªAPIèµ„æºæ¥æ»¡è¶³è¿™ä¸€éœ€æ±‚ã€‚ã€€ã€€</p>

<p>ConfigMapåŒ…å«äº†ä¸€ç³»åˆ—çš„é”®å€¼å¯¹ï¼Œç”¨äºå­˜å‚¨è¢«Podæˆ–è€…ç³»ç»Ÿç»„ä»¶ï¼ˆå¦‚controllerï¼‰è®¿é—®çš„ä¿¡æ¯ã€‚è¿™ä¸secretçš„è®¾è®¡ç†å¿µæœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºConfigMapé€šå¸¸ä¸ç”¨äºå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œè€Œåªå­˜å‚¨ç®€å•çš„æ–‡æœ¬ä¿¡æ¯ã€‚</p>

<h2 id="secret">Secret</h2>
<p><a href="https://kubernetes.io/zh/docs/concepts/configuration/secret/">secret</a></p>

<p>Secret æ˜¯ä¸€ç§åŒ…å«å°‘é‡æ•æ„Ÿä¿¡æ¯ä¾‹å¦‚å¯†ç ã€token æˆ– key çš„å¯¹è±¡ã€‚è¿™æ ·çš„ä¿¡æ¯å¯èƒ½ä¼šè¢«æ”¾åœ¨ Pod spec ä¸­æˆ–è€…é•œåƒä¸­ï¼›å°†å…¶æ”¾åœ¨ä¸€ä¸ª secret å¯¹è±¡ä¸­å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å®ƒçš„ç”¨é€”ï¼Œå¹¶é™ä½æ„å¤–æš´éœ²çš„é£é™©ã€‚
ç”¨æˆ·å¯ä»¥åˆ›å»º secretï¼ŒåŒæ—¶ç³»ç»Ÿä¹Ÿåˆ›å»ºäº†ä¸€äº› secretã€‚
è¦ä½¿ç”¨ secretï¼Œpod éœ€è¦å¼•ç”¨ secretã€‚Pod å¯ä»¥ç”¨ä¸¤ç§æ–¹å¼ä½¿ç”¨ secretï¼šä½œä¸º volume ä¸­çš„æ–‡ä»¶è¢«æŒ‚è½½åˆ° pod ä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨é‡Œï¼Œæˆ–è€…å½“ kubelet ä¸º pod æ‹‰å–é•œåƒæ—¶ä½¿ç”¨ã€‚</p>

<h2 id="è¯ä¹¦">è¯ä¹¦</h2>
<p><a href="https://kubernetes.io/zh/docs/concepts/cluster-administration/certificates/">è¯ä¹¦</a></p>

<p>å½“ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œè®¤è¯æ—¶ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ç°æœ‰éƒ¨ç½²è„šæœ¬ï¼Œæˆ–è€…é€šè¿‡ easyrsaã€openssl æˆ– cfssl æ‰‹åŠ¨ç”Ÿæˆè¯ä¹¦ã€‚</p>


    </article>
    <div class="share">
      <div class="share-component"></div>

    </div>
    <div class="comment">
      
    
        
        <!-- Disqus Protection, see https://github.com/mzlogin/mzlogin.github.io/issues/2 -->
        
            <div id="disqus_thread"></div>
            <script>
                var disqus_config = function () {
                    this.page.url = 'http://0.0.0.0:80/2018/08/01/kubernetes/';
                    this.page.identifier = '/2018/08/01/kubernetes/';
                    this.page.title = 'kubernetes æ ¸å¿ƒæ¦‚å¿µç®€è¿°';
                };
                (function() { // DON'T EDIT BELOW THIS LINE
                    var d = document, s = d.createElement('script');
                    s.type = 'text/javascript';
                    s.async = true;
                    var shortname = 'jevic-cn';
                    s.src = '//' + shortname + '.disqus.com/embed.js';
                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        
    


    </div>
  </div>
  <div class="column one-fourth">
    
<h3>Search</h3>
<div id="site_search">
    <input type="text" id="search_box" placeholder="Search">
    <button class="btn btn-default" id="site_search_do"><span class="octicon octicon-search"></span></button>
</div>

<ul id="search_results"></ul>

<link rel="stylesheet" type="text/css" href="/assets/css/modules/sidebar-search.css">
<script src="/assets/js/lunr.min.js"></script>
<script src="/assets/js/search.js"></script>

    
<h3>Post Directory</h3>
<div id="post-directory-module" class="mobile-hidden">
  <section class="post-directory">
  <!-- Links that trigger the jumping -->
  <!-- Added by javascript below -->
  <dl></dl>
  </section>
</div>

<script src="/assets/js/jquery.toc.js"></script>

  </div>
</div>
</section>
<!-- /section.content -->

    <footer class="container">
        <div class="site-footer" role="contentinfo">
            <div class="copyright left mobile-block">
                    Â© 2016~2019
                    <span title="Jevic">Jevic</span>
                    <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a>
            </div>

            <ul class="site-footer-links right mobile-hidden">
                <li>
                    <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC4.0</a>
                </li>
                <li>
                    <a href="javascript:window.scrollTo(0,0)" >TOP</a>
                </li>
            </ul>
            <a href="http://github.com/jevic/jevic.github.io" target="_blank" aria-label="view source code">
                <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
            </a>
            <ul class="site-footer-links mobile-hidden">
                
                <li>
                    <a href="/" title="é¦–é¡µ" target="">é¦–é¡µ</a>
                </li>
                
                <li>
                    <a href="/categories/" title="åˆ†ç±»" target="">åˆ†ç±»</a>
                </li>
                
                <li>
                    <a href="/wiki/" title="ç»´åŸº" target="">ç»´åŸº</a>
                </li>
                
                <li>
                    <a href="/open-source/" title="å¼€æº" target="">å¼€æº</a>
                </li>
                
                <li>
                    <a href="/links/" title="é“¾æ¥" target="">é“¾æ¥</a>
                </li>
                
                <li>
                    <a href="/about/" title="å…³äº" target="">å…³äº</a>
                </li>
                
                <li><a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li>
            </ul>

        </div>
    </footer>
    <!-- / footer -->
    <script src="/assets/vendor/share.js/dist/js/share.min.js"></script>
    <script src="/assets/js/geopattern.js"></script>
    <script src="/assets/js/prism.js"></script>
    <link rel="stylesheet" href="/assets/css/globals/prism.css">
    <script>
      jQuery(document).ready(function($) {
        // geopattern
        $('.geopattern').each(function(){
          $(this).geopattern($(this).data('pattern-id'));
        });
       // hljs.initHighlightingOnLoad();
      });
    </script>
    
    <div style="display:none">
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-82387173-1', 'auto');
        ga('send', 'pageview');

      </script>
    </div>
    
</body>
</html>
